<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yaya English: Ruoruo's Class</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4F46E5;
            --secondary: #0EA5E9;
            --accent: #F43F5E;
            --success: #10B981;
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --glass: rgba(255, 255, 255, 0.95);
            --shadow: 0 10px 40px rgba(0,0,0,0.15);
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: var(--bg-gradient);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            user-select: none;
        }

        /* --- Main App Container --- */
        #app-container {
            width: 90%;
            max-width: 1100px;
            height: 90vh;
            background: var(--glass);
            border-radius: 24px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            border: 4px solid white;
        }

        /* --- Header --- */
        header {
            background: white;
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #F1F5F9;
        }

        .brand {
            font-family: 'Fredoka One', cursive;
            font-size: 2rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .parent-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 10px rgba(79, 70, 229, 0.3);
        }
        .parent-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(79, 70, 229, 0.4); }

        /* --- Progress Bar --- */
        .progress-container { width: 100%; height: 10px; background: #F1F5F9; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, var(--secondary), var(--primary)); width: 0%; transition: width 0.5s ease; }

        /* --- Game Area --- */
        .game-area {
            flex: 1;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
        }

        h2 { font-family: 'Fredoka One'; font-size: 2.5rem; color: #1E293B; margin-bottom: 20px; }
        .instruction { font-size: 1.4rem; color: #64748B; margin-bottom: 30px; }

        /* --- Button Styles --- */
        .btn-game {
            background: white;
            border: 2px solid #CBD5E1;
            border-radius: 16px;
            padding: 20px 40px;
            font-size: 1.5rem;
            font-weight: 800;
            color: #334155;
            cursor: pointer;
            margin: 10px;
            transition: all 0.1s;
            box-shadow: 0 4px 0 #94A3B8;
            min-width: 150px;
        }
        .btn-game:active { transform: translateY(4px); box-shadow: 0 0 0 #94A3B8; }
        .btn-game.correct { background: #D1FAE5; border-color: #10B981; color: #065F46; box-shadow: 0 4px 0 #059669; }
        .btn-game.wrong { background: #FFE4E6; border-color: #F43F5E; color: #9F1239; box-shadow: 0 4px 0 #BE123C; animation: shake 0.4s; }

        /* --- Sentence Builder Styles --- */
        .sentence-slot {
            background: #F8FAFC;
            border: 3px dashed #CBD5E1;
            border-radius: 16px;
            padding: 20px;
            min-height: 80px;
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            width: 80%;
            margin-bottom: 30px;
        }
        
        .word-block {
            background: white;
            border: 2px solid var(--secondary);
            color: var(--secondary);
            padding: 10px 20px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 0 #0284C7;
        }
        .word-block:active { transform: translateY(4px); box-shadow: none; }

        /* --- Navigation Footer --- */
        .footer-nav {
            padding: 20px 40px;
            border-top: 1px solid #E2E8F0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
        }

        .next-btn {
            background: #10B981;
            color: white;
            border: none;
            padding: 15px 50px;
            border-radius: 50px;
            font-size: 1.5rem;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
            opacity: 0.5;
            pointer-events: none;
            transition: all 0.3s;
        }
        .next-btn.active { opacity: 1; pointer-events: auto; transform: scale(1.05); }
        .skip-btn { color: #94A3B8; background: none; border: none; font-weight: bold; cursor: pointer; text-decoration: underline; }

        /* --- Animations --- */
        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-5px);} 75% {transform: translateX(5px);} }
        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* --- Modal --- */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); z-index: 100; justify-content: center; align-items: center; }
        .modal-content { background: white; width: 80%; max-width: 800px; height: 80%; border-radius: 20px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
        .modal-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; background: #F8FAFC; }
        .modal-body { padding: 40px; overflow-y: auto; text-align: left; }
        .report-section { margin-bottom: 30px; }
        .report-label { font-weight: 800; color: #94A3B8; text-transform: uppercase; letter-spacing: 1px; font-size: 0.9rem; margin-bottom: 10px; }
        .report-text { font-size: 1.1rem; color: #334155; line-height: 1.6; }
        .chinese-text { display: block; color: #64748B; font-size: 1rem; margin-top: 5px; border-left: 4px solid #E2E8F0; padding-left: 15px; }

    </style>
</head>
<body>

    <div id="app-container">
        <header>
            <div class="brand">ü¶Å Yaya English</div>
            <button class="parent-btn" onclick="toggleModal(true)">For Parents / ÂÆ∂ÈïøÊä•Âëä üìÑ</button>
        </header>

        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <!-- Dynamic Game Content Goes Here -->
        <div id="game-content" class="game-area">
            <!-- Content Injected by JS -->
        </div>

        <div class="footer-nav">
            <button class="skip-btn" onclick="skipLevel()">Skip Level >></button>
            <button id="main-next-btn" class="next-btn" onclick="nextLevel()">Next Level ‚û°Ô∏è</button>
        </div>
    </div>

    <!-- Parent Report Modal -->
    <div class="modal-overlay" id="report-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="margin:0; font-size:1.5rem;">Class Report: Ruoruo (2025.12.19)</h2>
                <button onclick="toggleModal(false)" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="report-section">
                    <div class="report-label">üë®‚Äçüè´ Teacher's Feedback</div>
                    <div class="report-text">
                        Ruoruo was very smart today! We tackled some <strong>difficult grammar</strong>: distinguishing between "What is it?" and "Is it...?". Initially, the negative answer "No, it isn't" was tricky, but she mastered it by the end.
                        <span class="chinese-text">Ëã•Ëã•‰ªäÂ§©Ë°®Áé∞ÂæóÈùûÂ∏∏ËÅ™ÊòéÔºÅÊàë‰ª¨ÊîªÂÖã‰∫Ü‚ÄúIs it...?‚ÄùÁñëÈóÆÂè•Âíå‚ÄúNo, it isn't‚ÄùÂê¶ÂÆöÂõûÁ≠îÁöÑÈöæÁÇπ„ÄÇËµ∑ÂàùÂ•πÊúâÁÇπÁäπË±´Ôºå‰ΩÜÊúÄÂêéÊéåÊè°ÂæóÂæàÊ£íÔºÅ</span>
                    </div>
                </div>

                <div class="report-section">
                    <div class="report-label">üìö Key Vocabulary</div>
                    <div class="report-text">
                        <ul>
                            <li><strong>Clock</strong> (Êó∂Èíü)</li>
                            <li><strong>Desk</strong> (‰π¶Ê°å)</li>
                            <li><strong>Whiteboard</strong> vs <strong>Blackboard</strong></li>
                            <li><strong>Isn't</strong> (is not - ‰∏çÊòØ)</li>
                        </ul>
                    </div>
                </div>

                <div class="report-section">
                    <div class="report-label">üí° Grammar Focus</div>
                    <div class="report-text">
                        <strong>1. Question Order:</strong> Is it a pen? (Is ÊîæÂú®ÊúÄÂâçÈù¢)<br>
                        <strong>2. Negative Answer:</strong> <span style="color:var(--accent); font-weight:bold;">No, it isn't.</span> (Not "No it is")<br>
                        <strong>3. Pronouns:</strong> He (Boy), She (Girl), <strong>It</strong> (Thing).
                    </div>
                </div>

                <div class="report-section">
                    <div class="report-label">üè† Homework</div>
                    <div class="report-text">
                        Please play this app (20 games) to practice Sentence Building and Spelling.
                        <span class="chinese-text">ËØ∑ÂÆåÊàêËøô20‰∏™Â∞èÊ∏∏ÊàèÔºåÈáçÁÇπÁªÉ‰π†ÁªÑÂè•ÂíåÂçïËØçÊãºÂÜô„ÄÇ</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Game State & Data ---
        let currentLevelIndex = 0;
        const levels = [
            // --- WARM UP VOCAB ---
            { type: "vocab", word: "Clock", icon: "‚è∞", sentence: "It is a clock." },
            { type: "vocab", word: "Desk", icon: "ü™ë", sentence: "It is a desk." },
            { type: "vocab", word: "Whiteboard", icon: "‚¨ú", sentence: "It is a whiteboard." },
            
            // --- GRAMMAR: A vs AN ---
            { type: "choice", question: "A or An?", icon: "üçé", options: ["A", "An"], answer: "An", speech: "It is an apple." },
            { type: "choice", question: "A or An?", icon: "üñäÔ∏è", options: ["A", "An"], answer: "A", speech: "It is a pen." },

            // --- GRAMMAR: HE / SHE / IT ---
            { type: "choice", question: "He, She, or It?", icon: "üë©", options: ["He", "She", "It"], answer: "She", speech: "She is Mommy." },
            { type: "choice", question: "He, She, or It?", icon: "üë¶", options: ["He", "She", "It"], answer: "He", speech: "He is A-Ping." },
            { type: "choice", question: "He, She, or It?", icon: "ü™ë", options: ["He", "She", "It"], answer: "It", speech: "It is a desk." },

            // --- SENTENCE BUILDING (Syntax Focus) ---
            { type: "build", question: "Make the sentence:", icon: "‚è∞", target: ["It", "is", "a", "clock"], pool: ["a", "clock", "is", "It"] },
            { type: "build", question: "Make the sentence:", icon: "ü™ë", target: ["It", "is", "a", "desk"], pool: ["desk", "It", "is", "a"] },
            
            // --- QUESTION BUILDING ---
            { type: "build", question: "Ask a question:", icon: "‚ùì", target: ["Is", "it", "a", "pen"], pool: ["it", "pen", "a", "Is"] },
            { type: "build", question: "Ask a question:", icon: "‚ùì", target: ["Is", "it", "a", "book"], pool: ["book", "a", "it", "Is"] },

            // --- YES / NO LOGIC ---
            { type: "choice", question: "Is it a banana?", icon: "üçå", options: ["Yes, it is.", "No, it isn't."], answer: "Yes, it is.", speech: "Yes, it is." },
            { type: "choice", question: "Is it a pen?", icon: "üçé", options: ["Yes, it is.", "No, it isn't."], answer: "No, it isn't.", speech: "No, it isn't. It's an apple." },
            
            // --- NEGATIVE SENTENCE BUILDING ---
            { type: "build", question: "Make a NO answer:", icon: "‚ùå", target: ["No", ",", "it", "isn't"], pool: ["it", "isn't", "No", ","] },
            
            // --- SPELLING ---
            { type: "spell", question: "Spell it:", icon: "‚è∞", target: "CLOCK" },
            { type: "spell", question: "Spell it:", icon: "ü™ë", target: "DESK" },
            
            // --- FIX THE MISTAKE ---
            { type: "choice", question: "Fix: No, it _____.", icon: "‚ùå", options: ["is", "not", "isn't"], answer: "isn't", speech: "No, it isn't." },
            
            // --- FINAL REVIEW ---
            { type: "choice", question: "Touch the Blackboard", icon: "üëÇ", options: ["‚¨ú", "‚¨õ"], answer: "‚¨õ", speech: "Good job!" }
        ];

        // --- Init ---
        const container = document.getElementById('game-content');
        const nextBtn = document.getElementById('main-next-btn');
        const progressBar = document.getElementById('progress-bar');
        const synth = window.speechSynthesis;

        renderLevel();

        // --- Core Functions ---

        function updateProgress() {
            let pct = ((currentLevelIndex) / levels.length) * 100;
            progressBar.style.width = pct + "%";
        }

        function playSound(type) {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            
            if(type === 'win') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(500, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1000, ctx.currentTime + 0.1);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                osc.start(); osc.stop(ctx.currentTime + 0.3);
            } else {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(200, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                osc.start(); osc.stop(ctx.currentTime + 0.2);
            }
        }

        function speak(text) {
            if (synth.speaking) synth.cancel();
            let utter = new SpeechSynthesisUtterance(text);
            utter.lang = 'en-US';
            utter.rate = 0.85; // Slower for kids
            synth.speak(utter);
        }

        function enableNext() {
            nextBtn.classList.add('active');
            playSound('win');
        }

        function nextLevel() {
            if(currentLevelIndex < levels.length - 1) {
                currentLevelIndex++;
                renderLevel();
            } else {
                renderWinScreen();
            }
        }

        function skipLevel() {
            nextLevel();
        }

        function toggleModal(show) {
            document.getElementById('report-modal').style.display = show ? 'flex' : 'none';
        }

        // --- Render Logic ---

        function renderLevel() {
            updateProgress();
            nextBtn.classList.remove('active'); // Disable next button
            container.innerHTML = ''; // Clear screen
            
            const level = levels[currentLevelIndex];
            
            // Render Header
            const h2 = document.createElement('h2');
            h2.innerText = `Level ${currentLevelIndex + 1}: ${level.type === 'vocab' ? 'Review' : 'Game'}`;
            container.appendChild(h2);

            const iconDiv = document.createElement('div');
            iconDiv.style.fontSize = "5rem";
            iconDiv.style.marginBottom = "20px";
            iconDiv.innerText = level.icon;
            container.appendChild(iconDiv);

            // Render Specific Game Type
            if (level.type === 'vocab') {
                renderVocab(level);
            } else if (level.type === 'choice') {
                renderChoice(level);
            } else if (level.type === 'build') {
                renderBuild(level);
            } else if (level.type === 'spell') {
                renderSpell(level);
            }
        }

        // 1. VOCAB RENDERER
        function renderVocab(level) {
            const p = document.createElement('p');
            p.className = 'instruction';
            p.innerText = level.word;
            container.appendChild(p);

            const btn = document.createElement('button');
            btn.className = 'btn-game';
            btn.innerText = "üîä Listen";
            btn.onclick = () => {
                speak(level.sentence);
                enableNext();
            };
            container.appendChild(btn);
        }

        // 2. MULTIPLE CHOICE RENDERER
        function renderChoice(level) {
            const p = document.createElement('p');
            p.className = 'instruction';
            p.innerText = level.question;
            container.appendChild(p);

            const btnContainer = document.createElement('div');
            level.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'btn-game';
                btn.innerText = opt;
                btn.onclick = (e) => {
                    if(opt === level.answer) {
                        e.target.classList.add('correct');
                        speak(level.speech);
                        enableNext();
                        // Disable siblings
                        Array.from(btnContainer.children).forEach(b => b.disabled = true);
                    } else {
                        e.target.classList.add('wrong');
                        playSound('wrong');
                        speak("Try again.");
                        setTimeout(() => e.target.classList.remove('wrong'), 500);
                    }
                };
                btnContainer.appendChild(btn);
            });
            container.appendChild(btnContainer);
        }

        // 3. SENTENCE BUILDER RENDERER (Drag/Click logic)
        function renderBuild(level) {
            const p = document.createElement('p');
            p.className = 'instruction';
            p.innerText = level.question;
            container.appendChild(p);

            // Slot Area
            const slotArea = document.createElement('div');
            slotArea.className = 'sentence-slot';
            slotArea.id = 'build-slot';
            container.appendChild(slotArea);

            // Pool Area
            const poolArea = document.createElement('div');
            level.pool.forEach(word => {
                const btn = document.createElement('button');
                btn.className = 'word-block';
                btn.innerText = word;
                btn.onclick = () => {
                    // Move word to slot
                    const clone = btn.cloneNode(true);
                    clone.onclick = () => {
                        clone.remove(); // Remove from slot
                        btn.style.display = 'inline-block'; // Show in pool
                        checkSentence(level);
                    };
                    slotArea.appendChild(clone);
                    btn.style.display = 'none'; // Hide from pool
                    checkSentence(level);
                };
                poolArea.appendChild(btn);
            });
            container.appendChild(poolArea);

            // Reset Button
            const resetBtn = document.createElement('button');
            resetBtn.innerText = "üîÑ Clear";
            resetBtn.style.marginTop = "20px";
            resetBtn.style.background = "none"; resetBtn.style.border="none"; resetBtn.style.color="#94A3B8"; resetBtn.style.cursor="pointer";
            resetBtn.onclick = () => renderLevel(); // Re-render to reset
            container.appendChild(resetBtn);
        }

        function checkSentence(level) {
            const slot = document.getElementById('build-slot');
            const currentSentence = Array.from(slot.children).map(c => c.innerText).join(" ");
            const targetSentence = level.target.join(" ");
            
            if(currentSentence === targetSentence) {
                slot.style.borderColor = "#10B981";
                slot.style.background = "#ECFDF5";
                speak(targetSentence);
                enableNext();
            }
        }

        // 4. SPELLING RENDERER
        function renderSpell(level) {
            const p = document.createElement('p');
            p.className = 'instruction';
            p.innerText = "Tap letters to spell: " + level.target;
            container.appendChild(p);

            const display = document.createElement('div');
            display.style.fontSize = "3rem";
            display.style.letterSpacing = "10px";
            display.style.fontWeight = "bold";
            display.style.marginBottom = "30px";
            display.style.color = "#4F46E5";
            display.innerText = "_ ".repeat(level.target.length);
            display.id = 'spell-display';
            container.appendChild(display);

            // Scramble letters + extras
            let letters = level.target.split('');
            letters.push('S', 'A', 'E'); // Distractors
            letters.sort(() => Math.random() - 0.5);

            const poolDiv = document.createElement('div');
            let currentSpelling = "";

            letters.forEach(char => {
                const btn = document.createElement('button');
                btn.className = 'btn-game';
                btn.style.minWidth = "60px";
                btn.innerText = char;
                btn.onclick = () => {
                    currentSpelling += char;
                    document.getElementById('spell-display').innerText = currentSpelling;
                    if(currentSpelling === level.target) {
                        document.getElementById('spell-display').style.color = "#10B981";
                        speak(level.target);
                        enableNext();
                    } else if (currentSpelling.length >= level.target.length) {
                        playSound('wrong');
                        speak("Try again");
                        currentSpelling = "";
                        document.getElementById('spell-display').innerText = "_ ".repeat(level.target.length);
                    }
                };
                poolDiv.appendChild(btn);
            });
            container.appendChild(poolDiv);
        }

        // 5. WIN SCREEN
        function renderWinScreen() {
            container.innerHTML = `
                <div style="font-size: 6rem; animation: popIn 0.5s;">üèÜ</div>
                <h2>Congratulations Ruoruo!</h2>
                <p class="instruction">You are a Grammar Master!</p>
                <button class="btn-game correct" onclick="location.reload()">Play Again üîÑ</button>
            `;
            progressBar.style.width = "100%";
            speak("Congratulations! You are wonderful!");
            createConfetti();
        }

        function createConfetti() {
            for(let i=0; i<100; i++) {
                let d = document.createElement('div');
                d.style.position = 'fixed';
                d.style.width = '12px'; d.style.height = '12px';
                d.style.backgroundColor = ['#f00','#0f0','#00f','#ff0'][Math.floor(Math.random()*4)];
                d.style.left = Math.random()*100+'vw';
                d.style.top = '-10px';
                d.style.zIndex = '9999';
                d.style.transition = `top ${Math.random()*2+2}s linear, transform 2s linear`;
                document.body.appendChild(d);
                setTimeout(() => {
                    d.style.top = '110vh';
                    d.style.transform = `rotate(${Math.random()*360}deg)`;
                }, 100);
            }
        }

    </script>
</body>
</html>