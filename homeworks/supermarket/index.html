<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supermarket Learning Adventure</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Nunito', sans-serif;
    }
    
    /* HIDE SCROLLBARS BUT KEEP SCROLLING */
    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }
    .no-scrollbar {
      -ms-overflow-style: none;  /* IE and Edge */
      scrollbar-width: none;  /* Firefox */
    }
    
    @keyframes bounce-soft {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }
    
    @keyframes wiggle {
      0%, 100% { transform: rotate(-3deg); }
      50% { transform: rotate(3deg); }
    }
    
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 5px rgba(255,200,0,0.5); }
      50% { box-shadow: 0 0 20px rgba(255,200,0,0.8); }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      25% { transform: translateY(-5px) rotate(2deg); }
      75% { transform: translateY(5px) rotate(-2deg); }
    }
    
    @keyframes sparkle {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
    }
    
    @keyframes cart-shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-3px) rotate(-2deg); }
      75% { transform: translateX(3px) rotate(2deg); }
    }
    
    @keyframes cooking-steam {
      0% { opacity: 0; transform: translateY(0) scale(0.5); }
      50% { opacity: 1; transform: translateY(-10px) scale(1); }
      100% { opacity: 0; transform: translateY(-20px) scale(0.8); }
    }
    
    .bounce-soft { animation: bounce-soft 2s ease-in-out infinite; }
    .wiggle { animation: wiggle 1s ease-in-out infinite; }
    .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
    .float { animation: float 3s ease-in-out infinite; }
    .sparkle { animation: sparkle 1.5s ease-in-out infinite; }
    .cart-shake { animation: cart-shake 0.5s ease-in-out; }
    
    .food-item {
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .food-item:hover {
      transform: scale(1.05);
      border-color: #10b981; /* emerald-500 */
    }
    
    .tab-btn {
      transition: all 0.3s ease;
      white-space: nowrap; /* Prevent text wrapping */
    }
    
    .tab-btn.active {
      transform: scale(1.05);
    }

    .story-card {
        transition: transform 0.3s ease;
    }
    .story-card:hover {
        transform: translateY(-5px);
    }
    
    .cart-item {
      animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .steam {
      position: absolute;
      width: 8px;
      height: 8px;
      background: rgba(255,255,255,0.6);
      border-radius: 50%;
      animation: cooking-steam 2s ease-in-out infinite;
    }
    
    .category-card {
      transition: all 0.3s ease;
    }
    
    .category-card:hover {
      transform: translateY(-5px);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-gradient-to-br from-amber-50 via-orange-50 to-pink-50 overflow-auto">
  <div id="app" class="min-h-full w-full"><!-- Header -->
   <header class="bg-gradient-to-r from-emerald-500 via-teal-500 to-cyan-500 text-white p-4 shadow-lg">
    <div class="max-w-7xl mx-auto flex items-center justify-between flex-wrap gap-4">
     <div class="flex items-center gap-3">
      <div class="text-4xl bounce-soft">
       ğŸ›’
      </div>
      <div>
       <h1 id="store-title" class="text-2xl font-extrabold">Happy Market å¼€å¿ƒè¶…å¸‚</h1>
       <p id="welcome-text" class="text-emerald-100 text-sm">Learn English while shopping! è¾¹è´­ç‰©è¾¹å­¦è‹±è¯­!</p>
      </div>
     </div><!-- Wallet Display -->
     <div class="bg-white/20 backdrop-blur rounded-2xl p-3 flex items-center gap-3 pulse-glow">
      <div class="text-3xl wiggle">
       ğŸ‘›
      </div>
      <div>
       <div class="text-xs text-emerald-100">
        My Wallet æˆ‘çš„é’±åŒ…
       </div>
       <div class="flex items-center gap-2"><span class="text-2xl font-bold" id="wallet-display">$50.00</span> <button onclick="openWalletModal()" class="bg-yellow-400 text-yellow-800 px-2 py-1 rounded-full text-xs font-bold hover:bg-yellow-300 transition"> Edit ç¼–è¾‘ </button>
       </div>
      </div>
     </div>
    </div>
   </header>
   
   <!-- Navigation Tabs (NO SCROLLBAR) -->
   <nav class="bg-white shadow-md sticky top-0 z-40">
    <div class="max-w-7xl mx-auto flex overflow-x-auto no-scrollbar pb-1">
        <button onclick="switchTab('shop')" id="tab-shop" class="tab-btn active flex-1 py-4 px-6 font-bold text-emerald-600 border-b-4 border-emerald-500 bg-emerald-50 flex items-center justify-center gap-2"> 
            <span class="text-2xl">ğŸª</span> <span>Shop è´­ç‰©</span> 
        </button> 
        <button onclick="switchTab('cart')" id="tab-cart" class="tab-btn flex-1 py-4 px-6 font-bold text-gray-500 border-b-4 border-transparent hover:bg-gray-50 flex items-center justify-center gap-2"> 
            <span class="text-2xl">ğŸ›’</span> <span>Cart (<span id="cart-count">0</span>)</span> 
        </button> 
        <button onclick="switchTab('cooking')" id="tab-cooking" class="tab-btn flex-1 py-4 px-6 font-bold text-gray-500 border-b-4 border-transparent hover:bg-gray-50 flex items-center justify-center gap-2"> 
            <span class="text-2xl">ğŸ‘¨â€ğŸ³</span> <span>Cook çƒ¹é¥ª</span> 
        </button> 
        <button onclick="switchTab('vocab')" id="tab-vocab" class="tab-btn flex-1 py-4 px-6 font-bold text-gray-500 border-b-4 border-transparent hover:bg-gray-50 flex items-center justify-center gap-2"> 
            <span class="text-2xl">ğŸ“š</span> <span>Words è¯æ±‡</span> 
        </button> 
        <!-- NEW TAB: Stories -->
        <button onclick="switchTab('stories')" id="tab-stories" class="tab-btn flex-1 py-4 px-6 font-bold text-gray-500 border-b-4 border-transparent hover:bg-gray-50 flex items-center justify-center gap-2"> 
            <span class="text-2xl">ğŸ“–</span> <span>Stories æ•…äº‹</span> 
        </button>
        <button onclick="switchTab('kitchen')" id="tab-kitchen" class="tab-btn flex-1 py-4 px-6 font-bold text-gray-500 border-b-4 border-transparent hover:bg-gray-50 flex items-center justify-center gap-2"> 
            <span class="text-2xl">ğŸ§Š</span> <span>Kitchen å¨æˆ¿</span> 
        </button>
    </div>
   </nav>

   <main class="max-w-7xl mx-auto p-4 pb-32">
    <!-- Shopping Section -->
    <section id="section-shop" class="space-y-6"><!-- Category Cards -->
     <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"><button onclick="filterCategory('all')" class="category-card bg-gradient-to-br from-purple-400 to-purple-600 text-white p-4 rounded-2xl text-center shadow-lg">
       <div class="text-4xl mb-2">
        ğŸŒŸ
       </div>
       <div class="font-bold">
        All Items
       </div>
       <div class="text-purple-200 text-sm">
        æ‰€æœ‰å•†å“
       </div></button> <button onclick="filterCategory('fruits')" class="category-card bg-gradient-to-br from-red-400 to-orange-500 text-white p-4 rounded-2xl text-center shadow-lg">
       <div class="text-4xl mb-2">
        ğŸ
       </div>
       <div class="font-bold">
        Fruits
       </div>
       <div class="text-red-200 text-sm">
        æ°´æœ
       </div></button> <button onclick="filterCategory('vegetables')" class="category-card bg-gradient-to-br from-green-400 to-emerald-600 text-white p-4 rounded-2xl text-center shadow-lg">
       <div class="text-4xl mb-2">
        ğŸ¥¬
       </div>
       <div class="font-bold">
        Vegetables
       </div>
       <div class="text-green-200 text-sm">
        è”¬èœ
       </div></button> <button onclick="filterCategory('drinks')" class="category-card bg-gradient-to-br from-blue-400 to-cyan-500 text-white p-4 rounded-2xl text-center shadow-lg">
       <div class="text-4xl mb-2">
        ğŸ¥¤
       </div>
       <div class="font-bold">
        Drinks
       </div>
       <div class="text-blue-200 text-sm">
        é¥®æ–™
       </div></button> <button onclick="filterCategory('dairy')" class="category-card bg-gradient-to-br from-yellow-300 to-amber-500 text-white p-4 rounded-2xl text-center shadow-lg">
       <div class="text-4xl mb-2">
        ğŸ¥›
       </div>
       <div class="font-bold">
        Dairy
       </div>
       <div class="text-yellow-200 text-sm">
        ä¹³åˆ¶å“
       </div></button> <button onclick="filterCategory('meat')" class="category-card bg-gradient-to-br from-rose-400 to-red-600 text-white p-4 rounded-2xl text-center shadow-lg">
       <div class="text-4xl mb-2">
        ğŸ¥©
       </div>
       <div class="font-bold">
        Meat
       </div>
       <div class="text-rose-200 text-sm">
        è‚‰ç±»
       </div></button> <button onclick="filterCategory('bakery')" class="category-card bg-gradient-to-br from-amber-400 to-orange-600 text-white p-4 rounded-2xl text-center shadow-lg">
       <div class="text-4xl mb-2">
        ğŸ
       </div>
       <div class="font-bold">
        Bakery
       </div>
       <div class="text-amber-200 text-sm">
        çƒ˜ç„™
       </div></button> <button onclick="filterCategory('snacks')" class="category-card bg-gradient-to-br from-pink-400 to-fuchsia-500 text-white p-4 rounded-2xl text-center shadow-lg">
       <div class="text-4xl mb-2">
        ğŸª
       </div>
       <div class="font-bold">
        Snacks
       </div>
       <div class="text-pink-200 text-sm">
        é›¶é£Ÿ
       </div></button>
     </div><!-- Products Grid -->
     <div id="products-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"><!-- Products will be rendered here -->
     </div>
    </section>

    <!-- Cart Section -->
    <section id="section-cart" class="hidden space-y-4">
     <div class="bg-white rounded-3xl shadow-xl p-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2"><span class="text-3xl">ğŸ›’</span> Shopping Cart è´­ç‰©è½¦</h2>
      <div id="cart-items" class="space-y-3"><!-- Cart items will be rendered here -->
      </div>
      <div id="cart-empty" class="text-center py-12 text-gray-400">
       <div class="text-6xl mb-4">
        ğŸ›’
       </div>
       <p class="text-xl">Your cart is empty! è´­ç‰©è½¦æ˜¯ç©ºçš„!</p>
       <p class="text-sm">Add some items æ·»åŠ ä¸€äº›å•†å“å§</p>
      </div><!-- Cart Summary -->
      <div id="cart-summary" class="hidden mt-6 pt-6 border-t-2 border-dashed border-gray-200">
       <div class="flex justify-between items-center text-lg mb-2"><span class="text-gray-600">Subtotal å°è®¡:</span> <span id="subtotal" class="font-bold">$0.00</span>
       </div>
       <div class="flex justify-between items-center text-2xl font-bold text-emerald-600"><span>Total æ€»è®¡:</span> <span id="total">$0.00</span>
       </div>
       <div id="budget-warning" class="hidden mt-4 bg-red-100 text-red-600 p-3 rounded-xl text-center">
        âš ï¸ Not enough money! é’±ä¸å¤Ÿäº†!
       </div>
       <div id="budget-ok" class="hidden mt-4 bg-green-100 text-green-600 p-3 rounded-xl text-center">
        âœ… You can afford this! ä½ ä¹°å¾—èµ·!
       </div><button onclick="clearCart()" class="w-full mt-4 bg-gray-200 text-gray-600 py-3 rounded-xl font-bold hover:bg-gray-300 transition"> Clear Cart æ¸…ç©ºè´­ç‰©è½¦ </button>
      </div>
     </div>
    </section>

    <!-- Cooking Section -->
    <section id="section-cooking" class="hidden space-y-6"><!-- Cooking Vocabulary -->
     <div class="bg-white rounded-3xl shadow-xl p-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2"><span class="text-3xl">ğŸ”ª</span> Cooking Actions çƒ¹é¥ªåŠ¨ä½œ</h2>
      <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4" id="cooking-actions"><!-- Cooking actions will be rendered here -->
      </div>
     </div><!-- Recipes -->
     <div class="bg-white rounded-3xl shadow-xl p-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2"><span class="text-3xl">ğŸ“–</span> Simple Recipes ç®€å•é£Ÿè°±</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="recipes-grid"><!-- Recipes will be rendered here -->
      </div>
     </div>
    </section>

    <!-- Vocabulary Section -->
    <section id="section-vocab" class="hidden space-y-6">
     <div class="bg-white rounded-3xl shadow-xl p-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2"><span class="text-3xl">ğŸ“š</span> Food Vocabulary é£Ÿç‰©è¯æ±‡</h2>
      <p class="text-gray-500 mb-4 text-sm">Click to listen! ç‚¹å‡»æ”¶å¬!</p>
      <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4" id="vocab-grid"><!-- Vocabulary will be rendered here -->
      </div>
     </div><!-- Money Vocabulary -->
     <div class="bg-white rounded-3xl shadow-xl p-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2"><span class="text-3xl">ğŸ’°</span> Money Words é‡‘é’±è¯æ±‡</h2>
      <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4" id="money-vocab"><!-- Money vocabulary will be rendered here -->
      </div>
     </div>
    </section>

    <!-- NEW STORIES SECTION -->
    <section id="section-stories" class="hidden space-y-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
            <span class="text-3xl">ğŸ“–</span> Mini Stories è¿·ä½ æ•…äº‹
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Story 1 -->
            <div class="story-card bg-white rounded-3xl overflow-hidden shadow-lg border-2 border-emerald-100">
                <div class="aspect-video w-full bg-gray-100 relative">
                    
                    <img src="img_1768987122_9065.png" alt="Anna and Banana" class="w-full h-full object-cover">
                </div>
                <div class="p-6">
                    <h3 class="font-bold text-xl text-gray-800 mb-2">Anna likes Bananas</h3>
                    <p class="text-gray-600 mb-4">Anna slices a banana. She likes yellow bananas!</p>
                    
                    <!-- GEN_AUDIO: 
                    [TEACHER]: Anna slices a banana. She likes yellow bananas!
                    -->
                    <audio controls src="PLACEHOLDER" class="w-full"></audio>
                </div>
            </div>

            <!-- Story 2 -->
            <div class="story-card bg-white rounded-3xl overflow-hidden shadow-lg border-2 border-red-100">
                <div class="aspect-video w-full bg-gray-100 relative">
                    <!-- GEN_IMG: Cute cartoon boy eating a shiny red apple, minimalist vector style, flat design, white background, pastel colors, high quality -->
                    <img src="PLACEHOLDER" alt="Tom and Apple" class="w-full h-full object-cover">
                </div>
                <div class="p-6">
                    <h3 class="font-bold text-xl text-gray-800 mb-2">Tom's Red Apple</h3>
                    <p class="text-gray-600 mb-4">Tom has an apple. It is a sweet red apple.</p>
                    
                    <!-- GEN_AUDIO: 
                    [TEACHER]: Tom has an apple. It is a sweet red apple.
                    -->
                    <audio controls src="PLACEHOLDER" class="w-full"></audio>
                </div>
            </div>

            <!-- Story 3 -->
            <div class="story-card bg-white rounded-3xl overflow-hidden shadow-lg border-2 border-blue-100">
                <div class="aspect-video w-full bg-gray-100 relative">
                    <!-- GEN_IMG: Cute cartoon cat drinking milk from a bowl, minimalist vector style, flat design, white background, pastel colors, high quality -->
                    <img src="PLACEHOLDER" alt="Cat and Milk" class="w-full h-full object-cover">
                </div>
                <div class="p-6">
                    <h3 class="font-bold text-xl text-gray-800 mb-2">The Thirsty Cat</h3>
                    <p class="text-gray-600 mb-4">The cat drinks milk. Milk is yummy!</p>
                    
                    <!-- GEN_AUDIO: 
                    [TEACHER]: The cat drinks milk. Milk is yummy!
                    -->
                    <audio controls src="PLACEHOLDER" class="w-full"></audio>
                </div>
            </div>

            <!-- Story 4 -->
            <div class="story-card bg-white rounded-3xl overflow-hidden shadow-lg border-2 border-orange-100">
                <div class="aspect-video w-full bg-gray-100 relative">
                    
                    <img src="img_1768987312_5737.png" alt="Fresh Bread" class="w-full h-full object-cover">
                </div>
                <div class="p-6">
                    <h3 class="font-bold text-xl text-gray-800 mb-2">Fresh Bread</h3>
                    <p class="text-gray-600 mb-4">Mom buys bread. The bread is warm and soft.</p>
                    
                    <!-- GEN_AUDIO: 
                    [TEACHER]: Mom buys bread. The bread is warm and soft.
                    -->
                    <audio controls src="PLACEHOLDER" class="w-full"></audio>
                </div>
            </div>

            <!-- Story 5 -->
            <div class="story-card bg-white rounded-3xl overflow-hidden shadow-lg border-2 border-yellow-100">
                <div class="aspect-video w-full bg-gray-100 relative">
                    
                    <img src="img_1768987374_7140.png" alt="Cooking Eggs" class="w-full h-full object-cover">
                </div>
                <div class="p-6">
                    <h3 class="font-bold text-xl text-gray-800 mb-2">Cooking Eggs</h3>
                    <p class="text-gray-600 mb-4">I cook two eggs. One for me, one for you.</p>
                    
                    <!-- GEN_AUDIO: 
                    [TEACHER]: I cook two eggs. One for me, one for you.
                    -->
                    <audio controls src="PLACEHOLDER" class="w-full"></audio>
                </div>
            </div>

            <!-- Story 6 -->
            <div class="story-card bg-white rounded-3xl overflow-hidden shadow-lg border-2 border-pink-100">
                <div class="aspect-video w-full bg-gray-100 relative">
                    <!-- GEN_IMG: Cute cartoon girl eating ice cream, happy face, minimalist vector style, flat design, white background, pastel colors -->
                    <img src="PLACEHOLDER" alt="Ice Cream Time" class="w-full h-full object-cover">
                </div>
                <div class="p-6">
                    <h3 class="font-bold text-xl text-gray-800 mb-2">Ice Cream Time</h3>
                    <p class="text-gray-600 mb-4">It is hot today. Let's eat ice cream!</p>
                    
                    <!-- GEN_AUDIO: 
                    [TEACHER]: It is hot today. Let's eat ice cream!
                    -->
                    <audio controls src="PLACEHOLDER" class="w-full"></audio>
                </div>
            </div>
        </div>
    </section>

    <!-- Kitchen Section -->
    <section id="section-kitchen" class="hidden space-y-6"><!-- My Fridge -->
     <div class="bg-white rounded-3xl shadow-xl p-6">
      <div class="flex items-center justify-between mb-4">
       <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-2"><span class="text-3xl">ğŸ§Š</span> My Fridge æˆ‘çš„å†°ç®±</h2><button onclick="transferToFridge()" class="bg-emerald-500 text-white px-4 py-2 rounded-xl font-bold hover:bg-emerald-600 transition"> Move Cart to Fridge æŠŠè´­ç‰©è½¦æ”¾å…¥å†°ç®± </button>
      </div>
      <div id="fridge-items" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-3 min-h-[100px]"><!-- Fridge items will be rendered here -->
      </div>
      <div id="fridge-empty" class="text-center py-8 text-gray-400">
       <div class="text-5xl mb-2">
        ğŸ§Š
       </div>
       <p class="text-lg">Your fridge is empty! å†°ç®±æ˜¯ç©ºçš„!</p>
       <p class="text-sm">Buy items and move them here è´­ä¹°å•†å“å¹¶æ”¾å…¥è¿™é‡Œ</p>
      </div>
     </div><!-- What Can I Cook? -->
     <div class="bg-white rounded-3xl shadow-xl p-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2"><span class="text-3xl">ğŸ³</span> What Can I Cook? æˆ‘èƒ½åšä»€ä¹ˆèœ?</h2>
      <div id="recipe-suggestions" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"><!-- Recipe suggestions will be rendered here -->
      </div>
     </div><!-- Cooking Game -->
     <div id="cooking-game" class="hidden bg-gradient-to-br from-purple-500 via-pink-500 to-rose-500 rounded-3xl shadow-xl p-6 text-white">
      <div class="flex items-center justify-between mb-6">
       <h2 class="text-2xl font-bold flex items-center gap-2"><span class="text-3xl">ğŸ‘¨â€ğŸ³</span> <span id="game-recipe-name">Cooking...</span></h2><button onclick="exitCookingGame()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-xl font-bold transition"> Exit é€€å‡º </button>
      </div><!-- Cooking Bowl/Plate -->
      <div class="bg-white/20 backdrop-blur rounded-3xl p-8 mb-6 relative overflow-hidden min-h-[300px]">
       <div class="absolute top-4 left-1/2 -translate-x-1/2">
        <div class="text-6xl" id="cooking-container-emoji">
         ğŸ½ï¸
        </div>
       </div>
       <div id="cooking-bowl" class="flex flex-wrap justify-center items-center gap-3 pt-20"><!-- Ingredients will appear here -->
       </div>
       <div id="cooking-status" class="text-center mt-4 text-2xl font-bold">
        Let's start cooking! å¼€å§‹çƒ¹é¥ªå§!
       </div>
      </div><!-- Cooking Steps -->
      <div class="space-y-3" id="cooking-steps"><!-- Steps will be rendered here -->
      </div><!-- Completion -->
      <div id="cooking-complete" class="hidden text-center py-8">
       <div class="text-8xl mb-4 bounce-soft">
        ğŸ‰
       </div>
       <h3 class="text-3xl font-bold mb-2">Delicious! ç¾å‘³!</h3>
       <p class="text-xl opacity-90 mb-6">You made <span id="completed-dish-name"></span>!</p><button onclick="exitCookingGame()" class="bg-white text-purple-600 px-8 py-3 rounded-xl font-bold hover:bg-purple-50 transition"> Cook Another Dish å†åšä¸€é“èœ </button>
      </div>
     </div>
    </section>
   </main><!-- Calculator Widget (Fixed) -->
   <div id="calculator" class="fixed bottom-4 right-4 bg-white rounded-3xl shadow-2xl p-4 w-72 z-50 border-4 border-emerald-400">
    <div class="flex items-center justify-between mb-3">
     <h3 class="font-bold text-gray-800 flex items-center gap-2"><span class="text-xl">ğŸ§®</span> Calculator è®¡ç®—å™¨</h3><button onclick="toggleCalculator()" class="text-gray-400 hover:text-gray-600 text-xl">âœ•</button>
    </div><input type="text" id="calc-display" readonly class="w-full bg-gray-100 rounded-xl p-3 text-right text-2xl font-mono font-bold text-gray-800 mb-3" value="0">
    <div class="grid grid-cols-4 gap-2"><button onclick="calcInput('C')" class="bg-red-400 text-white p-3 rounded-xl font-bold hover:bg-red-500 transition">C</button> <button onclick="calcInput('Â±')" class="bg-gray-300 text-gray-700 p-3 rounded-xl font-bold hover:bg-gray-400 transition">Â±</button> <button onclick="calcInput('%')" class="bg-gray-300 text-gray-700 p-3 rounded-xl font-bold hover:bg-gray-400 transition">%</button> <button onclick="calcInput('Ã·')" class="bg-orange-400 text-white p-3 rounded-xl font-bold hover:bg-orange-500 transition">Ã·</button> <button onclick="calcInput('7')" class="bg-gray-100 text-gray-800 p-3 rounded-xl font-bold hover:bg-gray-200 transition">7</button> <button onclick="calcInput('8')" class="bg-gray-100 text-gray-800 p-3 rounded-xl font-bold hover:bg-gray-200 transition">8</button> <button onclick="calcInput('9')" class="bg-gray-100 text-gray-800 p-3 rounded-xl font-bold hover:bg-gray-200 transition">9</button> <button onclick="calcInput('Ã—')" class="bg-orange-400 text-white p-3 rounded-xl font-bold hover:bg-orange-500 transition">Ã—</button> <button onclick="calcInput('4')" class="bg-gray-100 text-gray-800 p-3 rounded-xl font-bold hover:bg-gray-200 transition">4</button> <button onclick="calcInput('5')" class="bg-gray-100 text-gray-800 p-3 rounded-xl font-bold hover:bg-gray-200 transition">5</button> <button onclick="calcInput('6')" class="bg-gray-100 text-gray-800 p-3 rounded-xl font-bold hover:bg-gray-200 transition">6</button> <button onclick="calcInput('-')" class="bg-orange-400 text-white p-3 rounded-xl font-bold hover:bg-orange-500 transition">âˆ’</button> <button onclick="calcInput('1')" class="bg-gray-100 text-gray-800 p-3 rounded-xl font-bold hover:bg-gray-200 transition">1</button> <button onclick="calcInput('2')" class="bg-gray-100 text-gray-800 p-3 rounded-xl font-bold hover:bg-gray-200 transition">2</button> <button onclick="calcInput('3')" class="bg-gray-100 text-gray-800 p-3 rounded-xl font-bold hover:bg-gray-200 transition">3</button> <button onclick="calcInput('+')" class="bg-orange-400 text-white p-3 rounded-xl font-bold hover:bg-orange-500 transition">+</button> <button onclick="calcInput('0')" class="bg-gray-100 text-gray-800 p-3 rounded-xl font-bold hover:bg-gray-200 transition col-span-2">0</button> <button onclick="calcInput('.')" class="bg-gray-100 text-gray-800 p-3 rounded-xl font-bold hover:bg-gray-200 transition">.</button> <button onclick="calcInput('=')" class="bg-emerald-500 text-white p-3 rounded-xl font-bold hover:bg-emerald-600 transition">=</button>
    </div>
   </div><!-- Calculator Toggle Button --> <button id="calc-toggle" onclick="toggleCalculator()" class="hidden fixed bottom-4 right-4 bg-emerald-500 text-white p-4 rounded-full shadow-2xl z-50 hover:bg-emerald-600 transition"> <span class="text-2xl">ğŸ§®</span> </button> <!-- Wallet Modal -->
   <div id="wallet-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl p-6 w-full max-w-md">
     <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2"><span class="text-3xl wiggle">ğŸ‘›</span> Edit Wallet ç¼–è¾‘é’±åŒ…</h3>
     <p class="text-gray-600 mb-4">How much money do you have? ä½ æœ‰å¤šå°‘é’±?</p>
     <div class="flex items-center gap-2 mb-6"><span class="text-3xl font-bold text-gray-400">$</span> <input type="number" id="wallet-input" min="0" step="0.01" class="flex-1 text-4xl font-bold text-emerald-600 border-b-4 border-emerald-400 focus:outline-none focus:border-emerald-600 bg-transparent" value="50.00">
     </div>
     <div class="grid grid-cols-3 gap-2 mb-6"><button onclick="setWallet(20)" class="bg-green-100 text-green-700 p-3 rounded-xl font-bold hover:bg-green-200 transition">$20</button> <button onclick="setWallet(50)" class="bg-green-100 text-green-700 p-3 rounded-xl font-bold hover:bg-green-200 transition">$50</button> <button onclick="setWallet(100)" class="bg-green-100 text-green-700 p-3 rounded-xl font-bold hover:bg-green-200 transition">$100</button>
     </div>
     <div class="flex gap-3"><button onclick="closeWalletModal()" class="flex-1 bg-gray-200 text-gray-600 py-3 rounded-xl font-bold hover:bg-gray-300 transition"> Cancel å–æ¶ˆ </button> <button onclick="saveWallet()" class="flex-1 bg-emerald-500 text-white py-3 rounded-xl font-bold hover:bg-emerald-600 transition"> Save ä¿å­˜ </button>
     </div>
    </div>
   </div><!-- Item Added Toast -->
   <div id="toast" class="hidden fixed top-24 left-1/2 -translate-x-1/2 bg-emerald-500 text-white px-6 py-3 rounded-full shadow-xl z-50 font-bold"><span class="text-xl mr-2">âœ“</span> <span id="toast-text">Added to cart!</span>
   </div>
   
   <!-- HIDDEN AUDIO BANK FOR VOCABULARY GENERATION -->
   <div id="vocab-audio-bank" class="hidden">
      <!-- GEN_AUDIO: [TEACHER]: Apple. This is an apple. -->
      <audio id="audio-word-1" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Banana. This is a yellow banana. -->
      <audio id="audio-word-2" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Orange. This is a sweet orange. -->
      <audio id="audio-word-3" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Grapes. These are purple grapes. -->
      <audio id="audio-word-4" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Strawberry. This is a red strawberry. -->
      <audio id="audio-word-5" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Peach. This is a juicy peach. -->
      <audio id="audio-word-6" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Cherry. This is a small cherry. -->
      <audio id="audio-word-7" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Kiwi. This is a green kiwi. -->
      <audio id="audio-word-8" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Lemon. This is a sour lemon. -->
      <audio id="audio-word-9" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Watermelon. This is a big watermelon. -->
      <audio id="audio-word-10" src="PLACEHOLDER"></audio>
      
      <!-- Vegetables -->
      <!-- GEN_AUDIO: [TEACHER]: Lettuce. This is fresh lettuce. -->
      <audio id="audio-word-11" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Carrot. This is an orange carrot. -->
      <audio id="audio-word-12" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Broccoli. This is green broccoli. -->
      <audio id="audio-word-13" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Tomato. This is a red tomato. -->
      <audio id="audio-word-14" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Cucumber. This is a long cucumber. -->
      <audio id="audio-word-15" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Onion. This is an onion. -->
      <audio id="audio-word-16" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Garlic. This is white garlic. -->
      <audio id="audio-word-17" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Corn. This is yellow corn. -->
      <audio id="audio-word-18" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Potato. This is a brown potato. -->
      <audio id="audio-word-19" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Pepper. This is a spicy pepper. -->
      <audio id="audio-word-20" src="PLACEHOLDER"></audio>

      <!-- Drinks -->
      <!-- GEN_AUDIO: [TEACHER]: Milk. This is white milk. -->
      <audio id="audio-word-21" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Juice. This is orange juice. -->
      <audio id="audio-word-22" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Soda. This is fizzy soda. -->
      <audio id="audio-word-23" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Water. This is fresh water. -->
      <audio id="audio-word-24" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Tea. This is hot tea. -->
      <audio id="audio-word-25" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Coffee. This is black coffee. -->
      <audio id="audio-word-26" src="PLACEHOLDER"></audio>

      <!-- Dairy -->
      <!-- GEN_AUDIO: [TEACHER]: Cheese. This is yellow cheese. -->
      <audio id="audio-word-27" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Eggs. These are white eggs. -->
      <audio id="audio-word-28" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Butter. This is yellow butter. -->
      <audio id="audio-word-29" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Ice Cream. This is sweet ice cream. -->
      <audio id="audio-word-30" src="PLACEHOLDER"></audio>

      <!-- Meat -->
      <!-- GEN_AUDIO: [TEACHER]: Steak. This is a beef steak. -->
      <audio id="audio-word-31" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Chicken. This is roasted chicken. -->
      <audio id="audio-word-32" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Bacon. This is crispy bacon. -->
      <audio id="audio-word-33" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Pork. This is meat from a pig. -->
      <audio id="audio-word-34" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Fish. This is a blue fish. -->
      <audio id="audio-word-35" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Shrimp. This is a pink shrimp. -->
      <audio id="audio-word-36" src="PLACEHOLDER"></audio>

      <!-- Bakery -->
      <!-- GEN_AUDIO: [TEACHER]: Bread. This is a loaf of bread. -->
      <audio id="audio-word-37" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Croissant. This is a french croissant. -->
      <audio id="audio-word-38" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Bagel. This is a round bagel. -->
      <audio id="audio-word-39" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Cake. This is a birthday cake. -->
      <audio id="audio-word-40" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Cupcake. This is a small cupcake. -->
      <audio id="audio-word-41" src="PLACEHOLDER"></audio>

      <!-- Snacks -->
      <!-- GEN_AUDIO: [TEACHER]: Cookie. This is a chocolate cookie. -->
      <audio id="audio-word-42" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Chocolate. This is a bar of chocolate. -->
      <audio id="audio-word-43" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Candy. This is sweet candy. -->
      <audio id="audio-word-44" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Popcorn. This is salty popcorn. -->
      <audio id="audio-word-45" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Peanuts. These are crunchy peanuts. -->
      <audio id="audio-word-46" src="PLACEHOLDER"></audio>
      <!-- GEN_AUDIO: [TEACHER]: Donut. This is a glazed donut. -->
      <audio id="audio-word-47" src="PLACEHOLDER"></audio>
   </div>
   
  </div>
  <script>
    // Default configuration
    const defaultConfig = {
      store_name: "Happy Market å¼€å¿ƒè¶…å¸‚",
      welcome_message: "Learn English while shopping! è¾¹è´­ç‰©è¾¹å­¦è‹±è¯­!",
      primary_color: "#10b981",
      secondary_color: "#f59e0b",
      background_color: "#fffbeb",
      text_color: "#1f2937",
      accent_color: "#ec4899"
    };

    // App state
    let wallet = 50.00;
    let cart = [];
    let fridge = [];
    let currentCategory = 'all';
    let calcValue = '0';
    let calcOperator = null;
    let calcPrevValue = null;
    let calcNewNumber = true;
    let currentCookingRecipe = null;
    let currentCookingStep = 0;

    // Products data with emoji, English, Chinese, and price
    const products = [
      // Fruits
      { id: 1, emoji: 'ğŸ', en: 'Apple', zh: 'è‹¹æœ', price: 1.50, category: 'fruits' },
      { id: 2, emoji: 'ğŸŒ', en: 'Banana', zh: 'é¦™è•‰', price: 0.80, category: 'fruits' },
      { id: 3, emoji: 'ğŸŠ', en: 'Orange', zh: 'æ©™å­', price: 1.20, category: 'fruits' },
      { id: 4, emoji: 'ğŸ‡', en: 'Grapes', zh: 'è‘¡è„', price: 3.50, category: 'fruits' },
      { id: 5, emoji: 'ğŸ“', en: 'Strawberry', zh: 'è‰è“', price: 4.00, category: 'fruits' },
      { id: 6, emoji: 'ğŸ‘', en: 'Peach', zh: 'æ¡ƒå­', price: 2.00, category: 'fruits' },
      { id: 7, emoji: 'ğŸ’', en: 'Cherry', zh: 'æ¨±æ¡ƒ', price: 5.00, category: 'fruits' },
      { id: 8, emoji: 'ğŸ¥', en: 'Kiwi', zh: 'çŒ•çŒ´æ¡ƒ', price: 1.80, category: 'fruits' },
      { id: 9, emoji: 'ğŸ‹', en: 'Lemon', zh: 'æŸ æª¬', price: 0.90, category: 'fruits' },
      { id: 10, emoji: 'ğŸ‰', en: 'Watermelon', zh: 'è¥¿ç“œ', price: 6.00, category: 'fruits' },
      
      // Vegetables
      { id: 11, emoji: 'ğŸ¥¬', en: 'Lettuce', zh: 'ç”Ÿèœ', price: 2.50, category: 'vegetables' },
      { id: 12, emoji: 'ğŸ¥•', en: 'Carrot', zh: 'èƒ¡èåœ', price: 1.00, category: 'vegetables' },
      { id: 13, emoji: 'ğŸ¥¦', en: 'Broccoli', zh: 'è¥¿å…°èŠ±', price: 2.80, category: 'vegetables' },
      { id: 14, emoji: 'ğŸ…', en: 'Tomato', zh: 'ç•ªèŒ„', price: 1.50, category: 'vegetables' },
      { id: 15, emoji: 'ğŸ¥’', en: 'Cucumber', zh: 'é»„ç“œ', price: 1.20, category: 'vegetables' },
      { id: 16, emoji: 'ğŸ§…', en: 'Onion', zh: 'æ´‹è‘±', price: 0.80, category: 'vegetables' },
      { id: 17, emoji: 'ğŸ§„', en: 'Garlic', zh: 'å¤§è’œ', price: 0.60, category: 'vegetables' },
      { id: 18, emoji: 'ğŸŒ½', en: 'Corn', zh: 'ç‰ç±³', price: 1.00, category: 'vegetables' },
      { id: 19, emoji: 'ğŸ¥”', en: 'Potato', zh: 'åœŸè±†', price: 0.70, category: 'vegetables' },
      { id: 20, emoji: 'ğŸŒ¶ï¸', en: 'Pepper', zh: 'è¾£æ¤’', price: 1.50, category: 'vegetables' },
      
      // Drinks
      { id: 21, emoji: 'ğŸ¥›', en: 'Milk', zh: 'ç‰›å¥¶', price: 3.50, category: 'drinks' },
      { id: 22, emoji: 'ğŸ§ƒ', en: 'Juice', zh: 'æœæ±', price: 2.50, category: 'drinks' },
      { id: 23, emoji: 'ğŸ¥¤', en: 'Soda', zh: 'æ±½æ°´', price: 1.80, category: 'drinks' },
      { id: 24, emoji: 'ğŸ’§', en: 'Water', zh: 'æ°´', price: 1.00, category: 'drinks' },
      { id: 25, emoji: 'ğŸµ', en: 'Tea', zh: 'èŒ¶', price: 2.00, category: 'drinks' },
      { id: 26, emoji: 'â˜•', en: 'Coffee', zh: 'å’–å•¡', price: 4.50, category: 'drinks' },
      
      // Dairy
      { id: 27, emoji: 'ğŸ§€', en: 'Cheese', zh: 'å¥¶é…ª', price: 5.00, category: 'dairy' },
      { id: 28, emoji: 'ğŸ¥š', en: 'Eggs', zh: 'é¸¡è›‹', price: 3.00, category: 'dairy' },
      { id: 29, emoji: 'ğŸ§ˆ', en: 'Butter', zh: 'é»„æ²¹', price: 4.00, category: 'dairy' },
      { id: 30, emoji: 'ğŸ¦', en: 'Ice Cream', zh: 'å†°æ·‡æ·‹', price: 4.50, category: 'dairy' },
      
      // Meat
      { id: 31, emoji: 'ğŸ¥©', en: 'Steak', zh: 'ç‰›æ’', price: 12.00, category: 'meat' },
      { id: 32, emoji: 'ğŸ—', en: 'Chicken', zh: 'é¸¡è‚‰', price: 6.00, category: 'meat' },
      { id: 33, emoji: 'ğŸ¥“', en: 'Bacon', zh: 'åŸ¹æ ¹', price: 5.50, category: 'meat' },
      { id: 34, emoji: 'ğŸ–', en: 'Pork', zh: 'çŒªè‚‰', price: 7.00, category: 'meat' },
      { id: 35, emoji: 'ğŸŸ', en: 'Fish', zh: 'é±¼', price: 8.00, category: 'meat' },
      { id: 36, emoji: 'ğŸ¦', en: 'Shrimp', zh: 'è™¾', price: 10.00, category: 'meat' },
      
      // Bakery
      { id: 37, emoji: 'ğŸ', en: 'Bread', zh: 'é¢åŒ…', price: 2.50, category: 'bakery' },
      { id: 38, emoji: 'ğŸ¥', en: 'Croissant', zh: 'ç‰›è§’åŒ…', price: 2.00, category: 'bakery' },
      { id: 39, emoji: 'ğŸ¥¯', en: 'Bagel', zh: 'ç™¾å‰é¥¼', price: 1.50, category: 'bakery' },
      { id: 40, emoji: 'ğŸ‚', en: 'Cake', zh: 'è›‹ç³•', price: 15.00, category: 'bakery' },
      { id: 41, emoji: 'ğŸ§', en: 'Cupcake', zh: 'çº¸æ¯è›‹ç³•', price: 3.00, category: 'bakery' },
      
      // Snacks
      { id: 42, emoji: 'ğŸª', en: 'Cookie', zh: 'é¥¼å¹²', price: 2.50, category: 'snacks' },
      { id: 43, emoji: 'ğŸ«', en: 'Chocolate', zh: 'å·§å…‹åŠ›', price: 3.50, category: 'snacks' },
      { id: 44, emoji: 'ğŸ¬', en: 'Candy', zh: 'ç³–æœ', price: 1.50, category: 'snacks' },
      { id: 45, emoji: 'ğŸ¿', en: 'Popcorn', zh: 'çˆ†ç±³èŠ±', price: 2.00, category: 'snacks' },
      { id: 46, emoji: 'ğŸ¥œ', en: 'Peanuts', zh: 'èŠ±ç”Ÿ', price: 2.50, category: 'snacks' },
      { id: 47, emoji: 'ğŸ©', en: 'Donut', zh: 'ç”œç”œåœˆ', price: 1.80, category: 'snacks' },
    ];

    // Cooking actions vocabulary
    const cookingActions = [
      { emoji: 'ğŸ”ª', en: 'Cut', zh: 'åˆ‡' },
      { emoji: 'ğŸ”ª', en: 'Slice', zh: 'åˆ‡ç‰‡' },
      { emoji: 'ğŸ”ª', en: 'Chop', zh: 'å‰ç¢' },
      { emoji: 'ğŸ”ª', en: 'Dice', zh: 'åˆ‡ä¸' },
      { emoji: 'ğŸ¥£', en: 'Mix', zh: 'æ··åˆ' },
      { emoji: 'ğŸ¥£', en: 'Stir', zh: 'æ…æ‹Œ' },
      { emoji: 'ğŸ³', en: 'Fry', zh: 'ç…' },
      { emoji: 'ğŸ³', en: 'Deep fry', zh: 'æ²¹ç‚¸' },
      { emoji: 'â™¨ï¸', en: 'Boil', zh: 'ç…®' },
      { emoji: 'â™¨ï¸', en: 'Steam', zh: 'è’¸' },
      { emoji: 'ğŸ”¥', en: 'Bake', zh: 'çƒ¤' },
      { emoji: 'ğŸ”¥', en: 'Roast', zh: 'çƒ˜çƒ¤' },
      { emoji: 'ğŸ”¥', en: 'Grill', zh: 'çƒ§çƒ¤' },
      { emoji: 'â„ï¸', en: 'Freeze', zh: 'å†·å†»' },
      { emoji: 'ğŸ§Š', en: 'Chill', zh: 'å†·å´' },
      { emoji: 'ğŸ’§', en: 'Wash', zh: 'æ´—' },
      { emoji: 'ğŸ¥„', en: 'Pour', zh: 'å€’' },
      { emoji: 'ğŸ¥„', en: 'Measure', zh: 'é‡' },
      { emoji: 'ğŸ½ï¸', en: 'Serve', zh: 'ä¸Šèœ' },
      { emoji: 'ğŸ‘ƒ', en: 'Taste', zh: 'å“å°' },
    ];

    // Simple recipes
    const recipes = [
      {
        name: 'Scrambled Eggs ç‚’é¸¡è›‹',
        emoji: 'ğŸ³',
        ingredients: ['ğŸ¥š Eggs é¸¡è›‹', 'ğŸ§ˆ Butter é»„æ²¹', 'ğŸ§‚ Salt ç›'],
        steps: ['Crack æ‰“ç ´', 'Beat æ‰“æ•£', 'Heat åŠ çƒ­', 'Pour å€’å…¥', 'Stir æ…æ‹Œ', 'Serve ä¸Šèœ'],
        color: 'from-yellow-400 to-orange-400'
      },
      {
        name: 'Fruit Salad æ°´æœæ²™æ‹‰',
        emoji: 'ğŸ¥—',
        ingredients: ['ğŸ Apple è‹¹æœ', 'ğŸŒ Banana é¦™è•‰', 'ğŸ‡ Grapes è‘¡è„', 'ğŸŠ Orange æ©™å­'],
        steps: ['Wash æ¸…æ´—', 'Cut åˆ‡', 'Mix æ··åˆ', 'Serve ä¸Šèœ'],
        color: 'from-green-400 to-emerald-500'
      },
      {
        name: 'Grilled Cheese çƒ¤å¥¶é…ªä¸‰æ˜æ²»',
        emoji: 'ğŸ§€',
        ingredients: ['ğŸ Bread é¢åŒ…', 'ğŸ§€ Cheese å¥¶é…ª', 'ğŸ§ˆ Butter é»„æ²¹'],
        steps: ['Spread æ¶‚æŠ¹', 'Layer æ”¾ç½®', 'Heat åŠ çƒ­', 'Flip ç¿»é¢', 'Serve ä¸Šèœ'],
        color: 'from-amber-400 to-yellow-500'
      },
      {
        name: 'Smoothie æœæ˜”',
        emoji: 'ğŸ¥¤',
        ingredients: ['ğŸŒ Banana é¦™è•‰', 'ğŸ“ Strawberry è‰è“', 'ğŸ¥› Milk ç‰›å¥¶'],
        steps: ['Cut åˆ‡', 'Add åŠ å…¥', 'Blend æ…æ‹Œ', 'Pour å€’å…¥', 'Serve ä¸Šèœ'],
        color: 'from-pink-400 to-rose-500'
      },
    ];

    // Detailed cooking recipes for the game
    const detailedRecipes = [
      {
        id: 'fruit-salad',
        name: 'Fruit Salad æ°´æœæ²™æ‹‰',
        emoji: 'ğŸ¥—',
        container: 'ğŸ¥—',
        category: 'fruits',
        requiredIngredients: ['Apple', 'Banana'],
        optionalIngredients: ['Orange', 'Grapes', 'Strawberry', 'Kiwi', 'Peach'],
        steps: [
          { action: 'wash', text: 'Wash all fruits æ¸…æ´—æ‰€æœ‰æ°´æœ', emoji: 'ğŸ’§', verb: 'Wash æ¸…æ´—' },
          { action: 'cut', text: 'Cut fruits into pieces æŠŠæ°´æœåˆ‡æˆå—', emoji: 'ğŸ”ª', verb: 'Cut åˆ‡' },
          { action: 'mix', text: 'Mix everything in bowl åœ¨ç¢—é‡Œæ··åˆ', emoji: 'ğŸ¥£', verb: 'Mix æ··åˆ' },
          { action: 'chill', text: 'Chill for freshness å†·è—ä¿é²œ', emoji: 'â„ï¸', verb: 'Chill å†·å´' },
          { action: 'serve', text: 'Serve and enjoy! ä¸Šèœäº«ç”¨!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      {
        id: 'smoothie',
        name: 'Smoothie æœæ˜”',
        emoji: 'ğŸ¥¤',
        container: 'ğŸ¥¤',
        category: 'fruits',
        requiredIngredients: ['Banana', 'Milk'],
        optionalIngredients: ['Strawberry', 'Grapes', 'Ice Cream'],
        steps: [
          { action: 'cut', text: 'Cut fruits into pieces æŠŠæ°´æœåˆ‡æˆå—', emoji: 'ğŸ”ª', verb: 'Cut åˆ‡' },
          { action: 'add', text: 'Add ingredients to blender åŠ å…¥æ…æ‹Œæœº', emoji: 'â•', verb: 'Add åŠ å…¥' },
          { action: 'blend', text: 'Blend until smooth æ…æ‹Œè‡³é¡ºæ»‘', emoji: 'ğŸŒªï¸', verb: 'Blend æ…æ‹Œ' },
          { action: 'pour', text: 'Pour into glass å€’å…¥æ¯ä¸­', emoji: 'ğŸ¥¤', verb: 'Pour å€’' },
          { action: 'serve', text: 'Serve cold! å†·é¥®ä¸Šæ¡Œ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      {
        id: 'vegetable-soup',
        name: 'Vegetable Soup è”¬èœæ±¤',
        emoji: 'ğŸ²',
        container: 'ğŸ²',
        category: 'vegetables',
        requiredIngredients: ['Carrot', 'Potato'],
        optionalIngredients: ['Onion', 'Tomato', 'Broccoli', 'Corn'],
        steps: [
          { action: 'wash', text: 'Wash vegetables æ¸…æ´—è”¬èœ', emoji: 'ğŸ’§', verb: 'Wash æ¸…æ´—' },
          { action: 'chop', text: 'Chop into small pieces åˆ‡æˆå°å—', emoji: 'ğŸ”ª', verb: 'Chop å‰ç¢' },
          { action: 'boil', text: 'Boil water in pot é”…é‡Œçƒ§æ°´', emoji: 'â™¨ï¸', verb: 'Boil ç…®' },
          { action: 'add', text: 'Add vegetables to pot æŠŠè”¬èœåŠ å…¥é”…ä¸­', emoji: 'ğŸ¥˜', verb: 'Add åŠ å…¥' },
          { action: 'stir', text: 'Stir and cook æ…æ‹Œçƒ¹é¥ª', emoji: 'ğŸ¥„', verb: 'Stir æ…æ‹Œ' },
          { action: 'serve', text: 'Serve hot! çƒ­æ±¤ä¸Šæ¡Œ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      {
        id: 'scrambled-eggs',
        name: 'Scrambled Eggs ç‚’é¸¡è›‹',
        emoji: 'ğŸ³',
        container: 'ğŸ³',
        category: 'dairy',
        requiredIngredients: ['Eggs', 'Butter'],
        optionalIngredients: ['Milk', 'Cheese'],
        steps: [
          { action: 'crack', text: 'Crack eggs into bowl æŠŠé¸¡è›‹æ‰“å…¥ç¢—ä¸­', emoji: 'ğŸ¥š', verb: 'Crack æ‰“ç ´' },
          { action: 'beat', text: 'Beat eggs well æŠŠé¸¡è›‹æ‰“æ•£', emoji: 'ğŸ¥„', verb: 'Beat æ‰“æ•£' },
          { action: 'heat', text: 'Heat pan with butter ç”¨é»„æ²¹åŠ çƒ­é”…', emoji: 'ğŸ”¥', verb: 'Heat åŠ çƒ­' },
          { action: 'pour', text: 'Pour eggs into pan æŠŠé¸¡è›‹å€’å…¥é”…ä¸­', emoji: 'ğŸ³', verb: 'Pour å€’å…¥' },
          { action: 'stir', text: 'Stir gently è½»è½»æ…æ‹Œ', emoji: 'ğŸ¥„', verb: 'Stir æ…æ‹Œ' },
          { action: 'serve', text: 'Serve warm! è¶çƒ­ä¸Šèœ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      {
        id: 'grilled-cheese',
        name: 'Grilled Cheese çƒ¤å¥¶é…ªä¸‰æ˜æ²»',
        emoji: 'ğŸ¥ª',
        container: 'ğŸ',
        category: 'bakery',
        requiredIngredients: ['Bread', 'Cheese', 'Butter'],
        optionalIngredients: ['Tomato'],
        steps: [
          { action: 'spread', text: 'Spread butter on bread åœ¨é¢åŒ…ä¸Šæ¶‚é»„æ²¹', emoji: 'ğŸ§ˆ', verb: 'Spread æ¶‚æŠ¹' },
          { action: 'layer', text: 'Layer cheese on bread åœ¨é¢åŒ…ä¸Šæ”¾å¥¶é…ª', emoji: 'ğŸ§€', verb: 'Layer æ”¾ç½®' },
          { action: 'heat', text: 'Heat pan åŠ çƒ­é”…', emoji: 'ğŸ”¥', verb: 'Heat åŠ çƒ­' },
          { action: 'grill', text: 'Grill until golden çƒ¤è‡³é‡‘é»„', emoji: 'ğŸ³', verb: 'Grill çƒ§çƒ¤' },
          { action: 'flip', text: 'Flip to other side ç¿»åˆ°å¦ä¸€é¢', emoji: 'ğŸ”„', verb: 'Flip ç¿»é¢' },
          { action: 'serve', text: 'Serve hot! è¶çƒ­ä¸Šæ¡Œ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      {
        id: 'chicken-rice',
        name: 'Chicken Rice é¸¡è‚‰é¥­',
        emoji: 'ğŸš',
        container: 'ğŸš',
        category: 'meat',
        requiredIngredients: ['Chicken'],
        optionalIngredients: ['Carrot', 'Corn', 'Onion'],
        steps: [
          { action: 'wash', text: 'Wash chicken æ¸…æ´—é¸¡è‚‰', emoji: 'ğŸ’§', verb: 'Wash æ¸…æ´—' },
          { action: 'cut', text: 'Cut chicken into pieces æŠŠé¸¡è‚‰åˆ‡å—', emoji: 'ğŸ”ª', verb: 'Cut åˆ‡' },
          { action: 'heat', text: 'Heat pan with oil ç”¨æ²¹åŠ çƒ­é”…', emoji: 'ğŸ”¥', verb: 'Heat åŠ çƒ­' },
          { action: 'fry', text: 'Fry chicken until cooked ç…é¸¡è‚‰è‡³ç†Ÿ', emoji: 'ğŸ³', verb: 'Fry ç…' },
          { action: 'boil', text: 'Boil rice ç…®é¥­', emoji: 'â™¨ï¸', verb: 'Boil ç…®' },
          { action: 'serve', text: 'Serve together! ä¸€èµ·ä¸Šèœ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      {
        id: 'sandwich',
        name: 'Sandwich ä¸‰æ˜æ²»',
        emoji: 'ğŸ¥ª',
        container: 'ğŸ¥ª',
        category: 'bakery',
        requiredIngredients: ['Bread'],
        optionalIngredients: ['Lettuce', 'Tomato', 'Cheese', 'Bacon', 'Chicken'],
        steps: [
          { action: 'wash', text: 'Wash vegetables æ¸…æ´—è”¬èœ', emoji: 'ğŸ’§', verb: 'Wash æ¸…æ´—' },
          { action: 'slice', text: 'Slice ingredients åˆ‡ç‰‡é£Ÿæ', emoji: 'ğŸ”ª', verb: 'Slice åˆ‡ç‰‡' },
          { action: 'layer', text: 'Layer ingredients on bread åœ¨é¢åŒ…ä¸Šå æ”¾é£Ÿæ', emoji: 'ğŸ¥ª', verb: 'Layer æ”¾ç½®' },
          { action: 'stack', text: 'Stack and press å èµ·å¹¶å‹å®', emoji: 'ğŸ‘†', verb: 'Press å‹' },
          { action: 'serve', text: 'Serve fresh! æ–°é²œä¸Šæ¡Œ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      {
        id: 'salad',
        name: 'Vegetable Salad è”¬èœæ²™æ‹‰',
        emoji: 'ğŸ¥—',
        container: 'ğŸ¥—',
        category: 'vegetables',
        requiredIngredients: ['Lettuce', 'Tomato'],
        optionalIngredients: ['Cucumber', 'Carrot', 'Onion', 'Pepper'],
        steps: [
          { action: 'wash', text: 'Wash vegetables æ¸…æ´—è”¬èœ', emoji: 'ğŸ’§', verb: 'Wash æ¸…æ´—' },
          { action: 'chop', text: 'Chop vegetables åˆ‡è”¬èœ', emoji: 'ğŸ”ª', verb: 'Chop å‰ç¢' },
          { action: 'mix', text: 'Mix in bowl åœ¨ç¢—ä¸­æ··åˆ', emoji: 'ğŸ¥£', verb: 'Mix æ··åˆ' },
          { action: 'chill', text: 'Chill before serving ä¸Šèœå‰å†·è—', emoji: 'â„ï¸', verb: 'Chill å†·å´' },
          { action: 'serve', text: 'Serve fresh! æ–°é²œä¸Šæ¡Œ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      // MORE DRINKS
      {
        id: 'milk-tea',
        name: 'Milk Tea å¥¶èŒ¶',
        emoji: 'ğŸ§‹',
        container: 'ğŸ¥¤',
        category: 'drinks',
        requiredIngredients: ['Tea', 'Milk'],
        optionalIngredients: [],
        steps: [
          { action: 'boil', text: 'Boil water çƒ§æ°´', emoji: 'â™¨ï¸', verb: 'Boil ç…®' },
          { action: 'steep', text: 'Steep tea æ³¡èŒ¶', emoji: 'ğŸµ', verb: 'Steep æµ¸æ³¡' },
          { action: 'add', text: 'Add milk åŠ ç‰›å¥¶', emoji: 'ğŸ¥›', verb: 'Add åŠ å…¥' },
          { action: 'stir', text: 'Stir well æ…æ‹Œå‡åŒ€', emoji: 'ğŸ¥„', verb: 'Stir æ…æ‹Œ' },
          { action: 'pour', text: 'Pour into cup å€’å…¥æ¯ä¸­', emoji: 'ğŸ¥¤', verb: 'Pour å€’' },
          { action: 'serve', text: 'Serve hot or cold! çƒ­é¥®æˆ–å†·é¥®!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      {
        id: 'lemonade',
        name: 'Lemonade æŸ æª¬æ°´',
        emoji: 'ğŸ‹',
        container: 'ğŸ¥¤',
        category: 'drinks',
        requiredIngredients: ['Lemon', 'Water'],
        optionalIngredients: [],
        steps: [
          { action: 'wash', text: 'Wash lemons æ¸…æ´—æŸ æª¬', emoji: 'ğŸ’§', verb: 'Wash æ¸…æ´—' },
          { action: 'cut', text: 'Cut lemons åˆ‡æŸ æª¬', emoji: 'ğŸ”ª', verb: 'Cut åˆ‡' },
          { action: 'squeeze', text: 'Squeeze lemon juice æŒ¤æŸ æª¬æ±', emoji: 'ğŸ‹', verb: 'Squeeze æŒ¤å‹' },
          { action: 'mix', text: 'Mix with water å’Œæ°´æ··åˆ', emoji: 'ğŸ¥£', verb: 'Mix æ··åˆ' },
          { action: 'chill', text: 'Chill with ice åŠ å†°å†·è—', emoji: 'ğŸ§Š', verb: 'Chill å†·å´' },
          { action: 'serve', text: 'Serve cold! å†·é¥®ä¸Šæ¡Œ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      {
        id: 'orange-juice',
        name: 'Fresh Orange Juice é²œæ©™æ±',
        emoji: 'ğŸŠ',
        container: 'ğŸ¥¤',
        category: 'drinks',
        requiredIngredients: ['Orange'],
        optionalIngredients: ['Lemon'],
        steps: [
          { action: 'wash', text: 'Wash oranges æ¸…æ´—æ©™å­', emoji: 'ğŸ’§', verb: 'Wash æ¸…æ´—' },
          { action: 'cut', text: 'Cut oranges in half æŠŠæ©™å­åˆ‡åŠ', emoji: 'ğŸ”ª', verb: 'Cut åˆ‡' },
          { action: 'squeeze', text: 'Squeeze juice out æ¦¨æ±', emoji: 'ğŸŠ', verb: 'Squeeze æŒ¤å‹' },
          { action: 'pour', text: 'Pour into glass å€’å…¥æ¯ä¸­', emoji: 'ğŸ¥¤', verb: 'Pour å€’' },
          { action: 'serve', text: 'Serve fresh! æ–°é²œä¸Šæ¡Œ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      {
        id: 'iced-coffee',
        name: 'Iced Coffee å†°å’–å•¡',
        emoji: 'â˜•',
        container: 'ğŸ¥¤',
        category: 'drinks',
        requiredIngredients: ['Coffee'],
        optionalIngredients: ['Milk', 'Ice Cream'],
        steps: [
          { action: 'brew', text: 'Brew coffee ç…®å’–å•¡', emoji: 'â˜•', verb: 'Brew å†²æ³¡' },
          { action: 'cool', text: 'Let it cool è®©å®ƒå†·å´', emoji: 'â„ï¸', verb: 'Cool å†·å´' },
          { action: 'add', text: 'Add ice åŠ å†°å—', emoji: 'ğŸ§Š', verb: 'Add åŠ å…¥' },
          { action: 'pour', text: 'Pour milk if desired åŠ ç‰›å¥¶', emoji: 'ğŸ¥›', verb: 'Pour å€’' },
          { action: 'serve', text: 'Serve cold! å†·é¥®ä¸Šæ¡Œ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      {
        id: 'watermelon-juice',
        name: 'Watermelon Juice è¥¿ç“œæ±',
        emoji: 'ğŸ‰',
        container: 'ğŸ¥¤',
        category: 'drinks',
        requiredIngredients: ['Watermelon'],
        optionalIngredients: ['Lemon'],
        steps: [
          { action: 'cut', text: 'Cut watermelon åˆ‡è¥¿ç“œ', emoji: 'ğŸ”ª', verb: 'Cut åˆ‡' },
          { action: 'scoop', text: 'Scoop out flesh æŒ–å‡ºæœè‚‰', emoji: 'ğŸ¥„', verb: 'Scoop æŒ–' },
          { action: 'blend', text: 'Blend until smooth æ…æ‹Œè‡³é¡ºæ»‘', emoji: 'ğŸŒªï¸', verb: 'Blend æ…æ‹Œ' },
          { action: 'pour', text: 'Pour into glass å€’å…¥æ¯ä¸­', emoji: 'ğŸ¥¤', verb: 'Pour å€’' },
          { action: 'serve', text: 'Serve chilled! å†·è—ä¸Šæ¡Œ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      // MORE MEAT DISHES
      {
        id: 'hot-pot',
        name: 'Hot Pot ç«é”…',
        emoji: 'ğŸ²',
        container: 'ğŸ²',
        category: 'meat',
        requiredIngredients: ['Chicken'],
        optionalIngredients: ['Lettuce', 'Broccoli', 'Carrot', 'Potato', 'Corn', 'Fish', 'Shrimp', 'Pork', 'Steak'],
        steps: [
          { action: 'boil', text: 'Boil water in pot é”…é‡Œçƒ§æ°´', emoji: 'â™¨ï¸', verb: 'Boil ç…®' },
          { action: 'wash', text: 'Wash all ingredients æ¸…æ´—æ‰€æœ‰é£Ÿæ', emoji: 'ğŸ’§', verb: 'Wash æ¸…æ´—' },
          { action: 'slice', text: 'Slice meat and vegetables åˆ‡è‚‰å’Œè”¬èœ', emoji: 'ğŸ”ª', verb: 'Slice åˆ‡ç‰‡' },
          { action: 'add', text: 'Add ingredients to pot æŠŠé£ŸæåŠ å…¥é”…ä¸­', emoji: 'ğŸ¥˜', verb: 'Add åŠ å…¥' },
          { action: 'cook', text: 'Cook in boiling water åœ¨æ²¸æ°´ä¸­ç…®', emoji: 'â™¨ï¸', verb: 'Cook ç…®' },
          { action: 'serve', text: 'Serve hot! è¶çƒ­ä¸Šæ¡Œ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      {
        id: 'grilled-steak',
        name: 'Grilled Steak çƒ¤ç‰›æ’',
        emoji: 'ğŸ¥©',
        container: 'ğŸ½ï¸',
        category: 'meat',
        requiredIngredients: ['Steak'],
        optionalIngredients: ['Garlic', 'Pepper', 'Butter'],
        steps: [
          { action: 'season', text: 'Season the steak ç»™ç‰›æ’è°ƒå‘³', emoji: 'ğŸ§‚', verb: 'Season è°ƒå‘³' },
          { action: 'heat', text: 'Heat grill pan åŠ çƒ­çƒ¤ç›˜', emoji: 'ğŸ”¥', verb: 'Heat åŠ çƒ­' },
          { action: 'grill', text: 'Grill each side çƒ¤æ¯ä¸€é¢', emoji: 'ğŸ¥©', verb: 'Grill çƒ§çƒ¤' },
          { action: 'flip', text: 'Flip to cook evenly ç¿»é¢å‡åŒ€çƒ¹é¥ª', emoji: 'ğŸ”„', verb: 'Flip ç¿»é¢' },
          { action: 'rest', text: 'Let it rest é™ç½®', emoji: 'â±ï¸', verb: 'Rest é™ç½®' },
          { action: 'serve', text: 'Serve hot! è¶çƒ­ä¸Šèœ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      {
        id: 'bacon-eggs',
        name: 'Bacon & Eggs åŸ¹æ ¹é¸¡è›‹',
        emoji: 'ğŸ¥“',
        container: 'ğŸ³',
        category: 'meat',
        requiredIngredients: ['Bacon', 'Eggs'],
        optionalIngredients: ['Butter', 'Cheese'],
        steps: [
          { action: 'heat', text: 'Heat pan åŠ çƒ­é”…', emoji: 'ğŸ”¥', verb: 'Heat åŠ çƒ­' },
          { action: 'fry', text: 'Fry bacon until crispy ç…åŸ¹æ ¹è‡³é…¥è„†', emoji: 'ğŸ¥“', verb: 'Fry ç…' },
          { action: 'crack', text: 'Crack eggs æ‰“é¸¡è›‹', emoji: 'ğŸ¥š', verb: 'Crack æ‰“ç ´' },
          { action: 'fry', text: 'Fry eggs ç…é¸¡è›‹', emoji: 'ğŸ³', verb: 'Fry ç…' },
          { action: 'serve', text: 'Serve together! ä¸€èµ·ä¸Šèœ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      {
        id: 'fish-fry',
        name: 'Fried Fish ç‚¸é±¼',
        emoji: 'ğŸŸ',
        container: 'ğŸ½ï¸',
        category: 'meat',
        requiredIngredients: ['Fish'],
        optionalIngredients: ['Lemon', 'Garlic'],
        steps: [
          { action: 'wash', text: 'Wash fish æ¸…æ´—é±¼', emoji: 'ğŸ’§', verb: 'Wash æ¸…æ´—' },
          { action: 'season', text: 'Season with salt ç”¨ç›è°ƒå‘³', emoji: 'ğŸ§‚', verb: 'Season è°ƒå‘³' },
          { action: 'heat', text: 'Heat oil in pan é”…é‡ŒåŠ çƒ­æ²¹', emoji: 'ğŸ”¥', verb: 'Heat åŠ çƒ­' },
          { action: 'fry', text: 'Fry until golden ç…è‡³é‡‘é»„', emoji: 'ğŸ³', verb: 'Fry ç…' },
          { action: 'serve', text: 'Serve with lemon! é…æŸ æª¬ä¸Šèœ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      {
        id: 'shrimp-stir-fry',
        name: 'Shrimp Stir-Fry ç‚’è™¾',
        emoji: 'ğŸ¦',
        container: 'ğŸ³',
        category: 'meat',
        requiredIngredients: ['Shrimp'],
        optionalIngredients: ['Garlic', 'Pepper', 'Broccoli', 'Carrot'],
        steps: [
          { action: 'wash', text: 'Wash shrimp æ¸…æ´—è™¾', emoji: 'ğŸ’§', verb: 'Wash æ¸…æ´—' },
          { action: 'heat', text: 'Heat pan with oil ç”¨æ²¹åŠ çƒ­é”…', emoji: 'ğŸ”¥', verb: 'Heat åŠ çƒ­' },
          { action: 'stir-fry', text: 'Stir-fry quickly å¿«é€Ÿç¿»ç‚’', emoji: 'ğŸ³', verb: 'Stir-fry ç‚’' },
          { action: 'season', text: 'Add seasoning åŠ è°ƒæ–™', emoji: 'ğŸ§‚', verb: 'Season è°ƒå‘³' },
          { action: 'serve', text: 'Serve hot! è¶çƒ­ä¸Šèœ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      // MORE BAKERY & SANDWICHES
      {
        id: 'bagel-sandwich',
        name: 'Bagel Sandwich ç™¾å‰é¥¼ä¸‰æ˜æ²»',
        emoji: 'ğŸ¥¯',
        container: 'ğŸ¥¯',
        category: 'bakery',
        requiredIngredients: ['Bagel'],
        optionalIngredients: ['Cheese', 'Eggs', 'Bacon', 'Tomato', 'Lettuce'],
        steps: [
          { action: 'slice', text: 'Slice bagel in half æŠŠç™¾å‰é¥¼åˆ‡åŠ', emoji: 'ğŸ”ª', verb: 'Slice åˆ‡ç‰‡' },
          { action: 'toast', text: 'Toast until golden çƒ¤è‡³é‡‘é»„', emoji: 'ğŸ”¥', verb: 'Toast çƒ¤' },
          { action: 'layer', text: 'Layer ingredients å æ”¾é£Ÿæ', emoji: 'ğŸ¥¯', verb: 'Layer æ”¾ç½®' },
          { action: 'serve', text: 'Serve fresh! æ–°é²œä¸Šæ¡Œ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      {
        id: 'croissant-sandwich',
        name: 'Croissant Sandwich ç‰›è§’åŒ…ä¸‰æ˜æ²»',
        emoji: 'ğŸ¥',
        container: 'ğŸ¥',
        category: 'bakery',
        requiredIngredients: ['Croissant'],
        optionalIngredients: ['Chicken', 'Cheese', 'Lettuce', 'Tomato'],
        steps: [
          { action: 'slice', text: 'Slice croissant åˆ‡ç‰›è§’åŒ…', emoji: 'ğŸ”ª', verb: 'Slice åˆ‡ç‰‡' },
          { action: 'layer', text: 'Layer ingredients inside åœ¨é‡Œé¢å æ”¾é£Ÿæ', emoji: 'ğŸ¥', verb: 'Layer æ”¾ç½®' },
          { action: 'serve', text: 'Serve fresh! æ–°é²œä¸Šæ¡Œ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      // MORE VEGETABLES
      {
        id: 'stir-fry',
        name: 'Stir-Fried Vegetables ç‚’è”¬èœ',
        emoji: 'ğŸ¥˜',
        container: 'ğŸ³',
        category: 'vegetables',
        requiredIngredients: ['Broccoli', 'Carrot'],
        optionalIngredients: ['Pepper', 'Onion', 'Garlic', 'Corn'],
        steps: [
          { action: 'wash', text: 'Wash vegetables æ¸…æ´—è”¬èœ', emoji: 'ğŸ’§', verb: 'Wash æ¸…æ´—' },
          { action: 'cut', text: 'Cut into pieces åˆ‡æˆå—', emoji: 'ğŸ”ª', verb: 'Cut åˆ‡' },
          { action: 'heat', text: 'Heat pan with oil ç”¨æ²¹åŠ çƒ­é”…', emoji: 'ğŸ”¥', verb: 'Heat åŠ çƒ­' },
          { action: 'stir-fry', text: 'Stir-fry quickly å¿«é€Ÿç¿»ç‚’', emoji: 'ğŸ³', verb: 'Stir-fry ç‚’' },
          { action: 'season', text: 'Add seasoning åŠ è°ƒæ–™', emoji: 'ğŸ§‚', verb: 'Season è°ƒå‘³' },
          { action: 'serve', text: 'Serve hot! è¶çƒ­ä¸Šèœ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      // MORE EGGS
      {
        id: 'omelette',
        name: 'Omelette ç…è›‹å·',
        emoji: 'ğŸ³',
        container: 'ğŸ³',
        category: 'dairy',
        requiredIngredients: ['Eggs'],
        optionalIngredients: ['Cheese', 'Tomato', 'Onion', 'Pepper', 'Butter'],
        steps: [
          { action: 'crack', text: 'Crack eggs into bowl æŠŠé¸¡è›‹æ‰“å…¥ç¢—ä¸­', emoji: 'ğŸ¥š', verb: 'Crack æ‰“ç ´' },
          { action: 'beat', text: 'Beat eggs well æŠŠé¸¡è›‹æ‰“æ•£', emoji: 'ğŸ¥„', verb: 'Beat æ‰“æ•£' },
          { action: 'heat', text: 'Heat pan åŠ çƒ­é”…', emoji: 'ğŸ”¥', verb: 'Heat åŠ çƒ­' },
          { action: 'pour', text: 'Pour eggs into pan æŠŠé¸¡è›‹å€’å…¥é”…ä¸­', emoji: 'ğŸ³', verb: 'Pour å€’å…¥' },
          { action: 'fold', text: 'Fold omelette æŠ˜å ç…è›‹', emoji: 'ğŸ”„', verb: 'Fold æŠ˜å ' },
          { action: 'serve', text: 'Serve hot! è¶çƒ­ä¸Šèœ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      // DESSERTS
      {
        id: 'ice-cream-sundae',
        name: 'Ice Cream Sundae åœ£ä»£å†°æ·‡æ·‹',
        emoji: 'ğŸ¨',
        container: 'ğŸ¨',
        category: 'dairy',
        requiredIngredients: ['Ice Cream'],
        optionalIngredients: ['Strawberry', 'Banana', 'Chocolate', 'Cherry'],
        steps: [
          { action: 'scoop', text: 'Scoop ice cream into bowl æŠŠå†°æ·‡æ·‹èˆ€å…¥ç¢—ä¸­', emoji: 'ğŸ¥„', verb: 'Scoop æŒ–' },
          { action: 'slice', text: 'Slice fruits åˆ‡æ°´æœ', emoji: 'ğŸ”ª', verb: 'Slice åˆ‡ç‰‡' },
          { action: 'top', text: 'Top with fruits æ”¾ä¸Šæ°´æœ', emoji: 'ğŸ“', verb: 'Top è£…é¥°' },
          { action: 'drizzle', text: 'Drizzle chocolate sauce æ·‹å·§å…‹åŠ›é…±', emoji: 'ğŸ«', verb: 'Drizzle æ·‹' },
          { action: 'serve', text: 'Serve immediately! ç«‹å³ä¸Šæ¡Œ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      },
      {
        id: 'fruit-cake',
        name: 'Fruit Cake æ°´æœè›‹ç³•',
        emoji: 'ğŸ°',
        container: 'ğŸ°',
        category: 'bakery',
        requiredIngredients: ['Cake'],
        optionalIngredients: ['Strawberry', 'Cherry', 'Peach', 'Ice Cream'],
        steps: [
          { action: 'slice', text: 'Slice cake åˆ‡è›‹ç³•', emoji: 'ğŸ”ª', verb: 'Slice åˆ‡ç‰‡' },
          { action: 'wash', text: 'Wash fruits æ¸…æ´—æ°´æœ', emoji: 'ğŸ’§', verb: 'Wash æ¸…æ´—' },
          { action: 'top', text: 'Top with fruits æ”¾ä¸Šæ°´æœ', emoji: 'ğŸ“', verb: 'Top è£…é¥°' },
          { action: 'chill', text: 'Chill before serving å†·è—åä¸Šæ¡Œ', emoji: 'â„ï¸', verb: 'Chill å†·å´' },
          { action: 'serve', text: 'Serve cold! å†·è—ä¸Šæ¡Œ!', emoji: 'ğŸ½ï¸', verb: 'Serve ä¸Šèœ' }
        ]
      }
    ];

    // Money vocabulary
    const moneyVocab = [
      { emoji: 'ğŸ’µ', en: 'Money', zh: 'é’±' },
      { emoji: 'ğŸ’°', en: 'Price', zh: 'ä»·æ ¼' },
      { emoji: 'ğŸ›’', en: 'Buy', zh: 'ä¹°' },
      { emoji: 'ğŸ’³', en: 'Pay', zh: 'æ”¯ä»˜' },
      { emoji: 'ğŸ§¾', en: 'Receipt', zh: 'æ”¶æ®' },
      { emoji: 'ğŸ’²', en: 'Dollar', zh: 'ç¾å…ƒ' },
      { emoji: 'ğŸª™', en: 'Coin', zh: 'ç¡¬å¸' },
      { emoji: 'ğŸ’¸', en: 'Spend', zh: 'èŠ±è´¹' },
      { emoji: 'ğŸ’¹', en: 'Total', zh: 'æ€»è®¡' },
      { emoji: 'ğŸ·ï¸', en: 'Discount', zh: 'æŠ˜æ‰£' },
      { emoji: 'ğŸ‘›', en: 'Wallet', zh: 'é’±åŒ…' },
      { emoji: 'ğŸ¤‘', en: 'Cheap', zh: 'ä¾¿å®œ' },
      { emoji: 'ğŸ’', en: 'Expensive', zh: 'è´µ' },
      { emoji: 'âœ…', en: 'Afford', zh: 'ä¹°å¾—èµ·' },
    ];

    // Initialize SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (config) => {
          document.getElementById('store-title').textContent = config.store_name || defaultConfig.store_name;
          document.getElementById('welcome-text').textContent = config.welcome_message || defaultConfig.welcome_message;
        },
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.primary_color || defaultConfig.primary_color,
              set: (value) => window.elementSdk.setConfig({ primary_color: value })
            },
            {
              get: () => config.secondary_color || defaultConfig.secondary_color,
              set: (value) => window.elementSdk.setConfig({ secondary_color: value })
            },
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => window.elementSdk.setConfig({ background_color: value })
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => window.elementSdk.setConfig({ text_color: value })
            },
            {
              get: () => config.accent_color || defaultConfig.accent_color,
              set: (value) => window.elementSdk.setConfig({ accent_color: value })
            }
          ],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ['store_name', config.store_name || defaultConfig.store_name],
          ['welcome_message', config.welcome_message || defaultConfig.welcome_message]
        ])
      });
    }

    // PLAY AUDIO HELPER
    function playProductAudio(id) {
        const audioElement = document.getElementById(`audio-word-${id}`);
        if (audioElement) {
            audioElement.play();
        }
    }

    // Render functions
    function renderProducts() {
      const grid = document.getElementById('products-grid');
      const filtered = currentCategory === 'all' 
        ? products 
        : products.filter(p => p.category === currentCategory);
      
      grid.innerHTML = filtered.map(product => `
        <div class="food-item bg-white rounded-2xl p-4 shadow-lg text-center relative group" onclick="addToCart(${product.id}); playProductAudio(${product.id});">
          <div class="absolute top-2 right-2 text-gray-300 opacity-50 text-xs">ğŸ”Š</div>
          <div class="text-5xl mb-2 float" style="animation-delay: ${Math.random() * 2}s">${product.emoji}</div>
          <div class="font-bold text-gray-800">${product.en}</div>
          <div class="text-gray-500 text-sm">${product.zh}</div>
          <div class="mt-2 bg-emerald-100 text-emerald-700 rounded-full py-1 px-3 text-sm font-bold inline-block">
            $${product.price.toFixed(2)}
          </div>
          <button class="mt-2 w-full bg-emerald-500 text-white py-2 rounded-xl font-bold hover:bg-emerald-600 transition text-sm">
            Add æ·»åŠ  +
          </button>
        </div>
      `).join('');
    }

    function renderCart() {
      const itemsEl = document.getElementById('cart-items');
      const emptyEl = document.getElementById('cart-empty');
      const summaryEl = document.getElementById('cart-summary');
      const countEl = document.getElementById('cart-count');
      
      countEl.textContent = cart.reduce((sum, item) => sum + item.qty, 0);
      
      if (cart.length === 0) {
        itemsEl.innerHTML = '';
        emptyEl.classList.remove('hidden');
        summaryEl.classList.add('hidden');
        return;
      }
      
      emptyEl.classList.add('hidden');
      summaryEl.classList.remove('hidden');
      
      itemsEl.innerHTML = cart.map(item => `
        <div class="cart-item flex items-center gap-4 bg-gray-50 rounded-2xl p-4">
          <div class="text-4xl">${item.emoji}</div>
          <div class="flex-1">
            <div class="font-bold text-gray-800">${item.en}</div>
            <div class="text-gray-500 text-sm">${item.zh}</div>
            <div class="text-emerald-600 font-bold">$${item.price.toFixed(2)} each æ¯ä¸ª</div>
          </div>
          <div class="flex items-center gap-2">
            <button onclick="updateQty(${item.id}, -1); event.stopPropagation();" class="w-8 h-8 bg-gray-200 rounded-full font-bold hover:bg-gray-300 transition">-</button>
            <span class="w-8 text-center font-bold">${item.qty}</span>
            <button onclick="updateQty(${item.id}, 1); event.stopPropagation();" class="w-8 h-8 bg-emerald-500 text-white rounded-full font-bold hover:bg-emerald-600 transition">+</button>
          </div>
          <div class="text-right">
            <div class="font-bold text-lg">$${(item.price * item.qty).toFixed(2)}</div>
            <button onclick="removeFromCart(${item.id}); event.stopPropagation();" class="text-red-400 hover:text-red-600 text-sm">
              Remove åˆ é™¤
            </button>
          </div>
        </div>
      `).join('');
      
      const total = cart.reduce((sum, item) => sum + item.price * item.qty, 0);
      document.getElementById('subtotal').textContent = `$${total.toFixed(2)}`;
      document.getElementById('total').textContent = `$${total.toFixed(2)}`;
      
      const warningEl = document.getElementById('budget-warning');
      const okEl = document.getElementById('budget-ok');
      
      if (total > wallet) {
        warningEl.classList.remove('hidden');
        okEl.classList.add('hidden');
      } else {
        warningEl.classList.add('hidden');
        okEl.classList.remove('hidden');
      }
    }

    function renderCookingActions() {
      const grid = document.getElementById('cooking-actions');
      grid.innerHTML = cookingActions.map((action, i) => `
        <div class="bg-gradient-to-br from-orange-100 to-amber-100 rounded-2xl p-4 text-center hover:scale-105 transition cursor-pointer" style="animation-delay: ${i * 0.1}s">
          <div class="text-4xl mb-2">${action.emoji}</div>
          <div class="font-bold text-orange-700">${action.en}</div>
          <div class="text-orange-500 text-sm">${action.zh}</div>
        </div>
      `).join('');
    }

    function renderRecipes() {
      const grid = document.getElementById('recipes-grid');
      grid.innerHTML = recipes.map(recipe => `
        <div class="bg-gradient-to-br ${recipe.color} rounded-2xl p-6 text-white">
          <div class="flex items-center gap-3 mb-4">
            <div class="text-5xl">${recipe.emoji}</div>
            <h3 class="text-xl font-bold">${recipe.name}</h3>
          </div>
          <div class="mb-4">
            <h4 class="font-bold mb-2 opacity-90">Ingredients é£Ÿæ:</h4>
            <div class="flex flex-wrap gap-2">
              ${recipe.ingredients.map(i => `<span class="bg-white/20 px-2 py-1 rounded-lg text-sm">${i}</span>`).join('')}
            </div>
          </div>
          <div>
            <h4 class="font-bold mb-2 opacity-90">Steps æ­¥éª¤:</h4>
            <div class="flex flex-wrap gap-2">
              ${recipe.steps.map((s, i) => `<span class="bg-white/20 px-2 py-1 rounded-lg text-sm">${i+1}. ${s}</span>`).join('')}
            </div>
          </div>
        </div>
      `).join('');
    }

    function renderVocab() {
      const grid = document.getElementById('vocab-grid');
      // We need to map products back to their ID to play audio
      const allVocab = products.map(p => ({ id: p.id, emoji: p.emoji, en: p.en, zh: p.zh }));
      // Filter unique by English name
      const uniqueVocab = allVocab.filter((v, i, arr) => arr.findIndex(x => x.en === v.en) === i);
      
      grid.innerHTML = uniqueVocab.slice(0, 47).map((word, i) => `
        <div class="bg-gradient-to-br from-violet-100 to-purple-100 rounded-2xl p-3 text-center hover:scale-105 transition cursor-pointer relative" onclick="playProductAudio(${word.id})" style="animation-delay: ${i * 0.05}s">
          <div class="absolute top-2 right-2 text-violet-400 text-xs">ğŸ”Š</div>
          <div class="text-3xl mb-1">${word.emoji}</div>
          <div class="font-bold text-violet-700 text-sm">${word.en}</div>
          <div class="text-violet-500 text-xs">${word.zh}</div>
        </div>
      `).join('');
    }

    function renderMoneyVocab() {
      const grid = document.getElementById('money-vocab');
      grid.innerHTML = moneyVocab.map((word, i) => `
        <div class="bg-gradient-to-br from-emerald-100 to-teal-100 rounded-2xl p-3 text-center hover:scale-105 transition cursor-pointer" style="animation-delay: ${i * 0.05}s">
          <div class="text-3xl mb-1">${word.emoji}</div>
          <div class="font-bold text-emerald-700 text-sm">${word.en}</div>
          <div class="text-emerald-500 text-xs">${word.zh}</div>
        </div>
      `).join('');
    }

    // Tab switching
    function switchTab(tab) {
      ['shop', 'cart', 'cooking', 'vocab', 'kitchen', 'stories'].forEach(t => {
        const section = document.getElementById(`section-${t}`);
        const btn = document.getElementById(`tab-${t}`);
        if(section) section.classList.add('hidden');
        if(btn) {
            btn.classList.remove('active', 'text-emerald-600', 'border-emerald-500', 'bg-emerald-50');
            btn.classList.add('text-gray-500', 'border-transparent');
        }
      });
      
      const section = document.getElementById(`section-${tab}`);
      const btn = document.getElementById(`tab-${tab}`);
      if(section) section.classList.remove('hidden');
      if(btn) {
          btn.classList.add('active', 'text-emerald-600', 'border-emerald-500', 'bg-emerald-50');
          btn.classList.remove('text-gray-500', 'border-transparent');
      }
      
      if (tab === 'kitchen') {
        renderFridge();
        renderRecipeSuggestions();
      }
    }

    // Category filtering
    function filterCategory(category) {
      currentCategory = category;
      renderProducts();
    }

    // Cart functions
    function addToCart(productId) {
      const product = products.find(p => p.id === productId);
      const existing = cart.find(item => item.id === productId);
      
      if (existing) {
        existing.qty++;
      } else {
        cart.push({ ...product, qty: 1 });
      }
      
      renderCart();
      showToast(`Added ${product.en}! å·²æ·»åŠ ${product.zh}!`);
      
      // Animate cart icon
      document.getElementById('tab-cart').classList.add('cart-shake');
      setTimeout(() => document.getElementById('tab-cart').classList.remove('cart-shake'), 500);
    }

    function updateQty(productId, delta) {
      const item = cart.find(i => i.id === productId);
      if (item) {
        item.qty += delta;
        if (item.qty <= 0) {
          removeFromCart(productId);
        } else {
          renderCart();
        }
      }
    }

    function removeFromCart(productId) {
      cart = cart.filter(i => i.id !== productId);
      renderCart();
    }

    function clearCart() {
      cart = [];
      renderCart();
      showToast('Cart cleared! è´­ç‰©è½¦å·²æ¸…ç©º!');
    }

    // Toast notification
    function showToast(message) {
      const toast = document.getElementById('toast');
      document.getElementById('toast-text').textContent = message;
      toast.classList.remove('hidden');
      setTimeout(() => toast.classList.add('hidden'), 2000);
    }

    // Wallet functions
    function openWalletModal() {
      document.getElementById('wallet-input').value = wallet.toFixed(2);
      document.getElementById('wallet-modal').classList.remove('hidden');
    }

    function closeWalletModal() {
      document.getElementById('wallet-modal').classList.add('hidden');
    }

    function setWallet(amount) {
      document.getElementById('wallet-input').value = amount.toFixed(2);
    }

    function saveWallet() {
      const input = document.getElementById('wallet-input');
      wallet = parseFloat(input.value) || 0;
      document.getElementById('wallet-display').textContent = `$${wallet.toFixed(2)}`;
      closeWalletModal();
      renderCart();
      showToast(`Wallet updated! é’±åŒ…å·²æ›´æ–°! $${wallet.toFixed(2)}`);
    }

    // Calculator functions
    function toggleCalculator() {
      const calc = document.getElementById('calculator');
      const toggle = document.getElementById('calc-toggle');
      calc.classList.toggle('hidden');
      toggle.classList.toggle('hidden');
    }

    function calcInput(key) {
      const display = document.getElementById('calc-display');
      
      if (key === 'C') {
        calcValue = '0';
        calcOperator = null;
        calcPrevValue = null;
        calcNewNumber = true;
      } else if (key === 'Â±') {
        calcValue = (parseFloat(calcValue) * -1).toString();
      } else if (key === '%') {
        calcValue = (parseFloat(calcValue) / 100).toString();
      } else if (['+', '-', 'Ã—', 'Ã·'].includes(key)) {
        calcPrevValue = calcValue;
        calcOperator = key;
        calcNewNumber = true;
      } else if (key === '=') {
        if (calcOperator && calcPrevValue !== null) {
          const a = parseFloat(calcPrevValue);
          const b = parseFloat(calcValue);
          let result;
          switch (calcOperator) {
            case '+': result = a + b; break;
            case '-': result = a - b; break;
            case 'Ã—': result = a * b; break;
            case 'Ã·': result = b !== 0 ? a / b : 'Error'; break;
          }
          calcValue = typeof result === 'number' ? result.toFixed(2).replace(/\.?0+$/, '') : result;
          calcOperator = null;
          calcPrevValue = null;
          calcNewNumber = true;
        }
      } else if (key === '.') {
        if (!calcValue.includes('.')) {
          calcValue += '.';
        }
      } else {
        if (calcNewNumber) {
          calcValue = key;
          calcNewNumber = false;
        } else {
          calcValue = calcValue === '0' ? key : calcValue + key;
        }
      }
      
      display.value = calcValue;
    }

    // Initialize app
    renderProducts();
    renderCart();
    renderCookingActions();
    renderRecipes();
    renderVocab();
    renderMoneyVocab();
    
    // Kitchen/Fridge functions
    function transferToFridge() {
      if (cart.length === 0) {
        showToast('Cart is empty! è´­ç‰©è½¦æ˜¯ç©ºçš„!');
        return;
      }
      
      const total = cart.reduce((sum, item) => sum + item.price * item.qty, 0);
      if (total > wallet) {
        showToast('Not enough money! é’±ä¸å¤Ÿ!');
        return;
      }
      
      // Deduct money
      wallet -= total;
      document.getElementById('wallet-display').textContent = `$${wallet.toFixed(2)}`;
      
      // Move items to fridge
      cart.forEach(cartItem => {
        const existingInFridge = fridge.find(f => f.id === cartItem.id);
        if (existingInFridge) {
          existingInFridge.qty += cartItem.qty;
        } else {
          fridge.push({ ...cartItem });
        }
      });
      
      // Clear cart
      cart = [];
      renderCart();
      renderFridge();
      renderRecipeSuggestions();
      showToast('Moved to fridge! å·²æ”¾å…¥å†°ç®±!');
    }
    
    function renderFridge() {
      const itemsEl = document.getElementById('fridge-items');
      const emptyEl = document.getElementById('fridge-empty');
      
      if (fridge.length === 0) {
        itemsEl.innerHTML = '';
        emptyEl.classList.remove('hidden');
        return;
      }
      
      emptyEl.classList.add('hidden');
      itemsEl.innerHTML = fridge.map(item => `
        <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl p-3 text-center relative group hover:scale-105 transition">
          <div class="text-4xl mb-1">${item.emoji}</div>
          <div class="text-xs font-bold text-gray-700">${item.en}</div>
          <div class="text-xs text-gray-500">${item.zh}</div>
          <div class="mt-1 bg-cyan-500 text-white rounded-full text-xs font-bold px-2 py-0.5 inline-block">
            ${item.qty}
          </div>
          <button onclick="removeFromFridge(${item.id})" class="absolute top-1 right-1 bg-red-400 text-white w-5 h-5 rounded-full text-xs opacity-0 group-hover:opacity-100 transition">Ã—</button>
        </div>
      `).join('');
    }
    
    function removeFromFridge(productId) {
      const item = fridge.find(f => f.id === productId);
      if (item) {
        item.qty--;
        if (item.qty <= 0) {
          fridge = fridge.filter(f => f.id !== productId);
        }
        renderFridge();
        renderRecipeSuggestions();
      }
    }
    
    function renderRecipeSuggestions() {
      const suggestionsEl = document.getElementById('recipe-suggestions');
      
      if (fridge.length === 0) {
        suggestionsEl.innerHTML = `
          <div class="col-span-full text-center py-8 text-gray-400">
            <div class="text-5xl mb-2">ğŸ¤”</div>
            <p class="text-lg">No ingredients yet! è¿˜æ²¡æœ‰é£Ÿæ!</p>
            <p class="text-sm">Buy some items first å…ˆå»ä¹°ä¸€äº›å•†å“å§</p>
          </div>
        `;
        return;
      }
      
      const fridgeItemNames = fridge.map(f => f.en);
      const possibleRecipes = detailedRecipes.filter(recipe => {
        return recipe.requiredIngredients.every(ing => fridgeItemNames.includes(ing));
      });
      
      if (possibleRecipes.length === 0) {
        suggestionsEl.innerHTML = `
          <div class="col-span-full text-center py-8 text-gray-400">
            <div class="text-5xl mb-2">ğŸ˜•</div>
            <p class="text-lg">Can't cook anything yet! è¿˜ä¸èƒ½åšèœ!</p>
            <p class="text-sm">You need: Apple + Banana, or Bread + Cheese, etc.</p>
          </div>
        `;
        return;
      }
      
      suggestionsEl.innerHTML = possibleRecipes.map(recipe => {
        const hasAll = [...recipe.requiredIngredients, ...recipe.optionalIngredients]
          .filter(ing => fridgeItemNames.includes(ing));
        
        return `
          <div class="bg-gradient-to-br from-orange-400 to-rose-500 rounded-2xl p-5 text-white relative overflow-hidden">
            <div class="absolute top-0 right-0 text-8xl opacity-20">${recipe.emoji}</div>
            <div class="relative">
              <div class="text-5xl mb-3">${recipe.emoji}</div>
              <h3 class="text-xl font-bold mb-3">${recipe.name}</h3>
              <div class="mb-3">
                <p class="text-sm opacity-90 mb-1">You have: ä½ æœ‰:</p>
                <div class="flex flex-wrap gap-1">
                  ${hasAll.map(ing => {
                    const prod = products.find(p => p.en === ing);
                    return `<span class="text-xs bg-white/20 px-2 py-1 rounded-full">${prod?.emoji} ${ing}</span>`;
                  }).join('')}
                </div>
              </div>
              <button onclick="startCooking('${recipe.id}')" class="w-full bg-white text-orange-600 py-2 rounded-xl font-bold hover:bg-orange-50 transition">
                Start Cooking! å¼€å§‹çƒ¹é¥ª!
              </button>
            </div>
          </div>
        `;
      }).join('');
    }
    
    function startCooking(recipeId) {
      currentCookingRecipe = detailedRecipes.find(r => r.id === recipeId);
      currentCookingStep = 0;
      
      document.getElementById('game-recipe-name').textContent = currentCookingRecipe.name;
      document.getElementById('cooking-container-emoji').textContent = currentCookingRecipe.container;
      document.getElementById('cooking-game').classList.remove('hidden');
      document.getElementById('cooking-complete').classList.add('hidden');
      document.getElementById('cooking-steps').classList.remove('hidden');
      
      // Show all ingredients in the bowl
      const fridgeItemNames = fridge.map(f => f.en);
      const availableIngredients = [...currentCookingRecipe.requiredIngredients, ...currentCookingRecipe.optionalIngredients]
        .filter(ing => fridgeItemNames.includes(ing));
      
      const bowlEl = document.getElementById('cooking-bowl');
      bowlEl.innerHTML = availableIngredients.map(ing => {
        const prod = products.find(p => p.en === ing);
        return `<div class="text-4xl float" style="animation-delay: ${Math.random()}s">${prod?.emoji}</div>`;
      }).join('');
      
      document.getElementById('cooking-status').textContent = `Let's cook ${currentCookingRecipe.name}!`;
      
      renderCookingSteps();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    function renderCookingSteps() {
      const stepsEl = document.getElementById('cooking-steps');
      stepsEl.innerHTML = currentCookingRecipe.steps.map((step, index) => {
        const isCompleted = index < currentCookingStep;
        const isCurrent = index === currentCookingStep;
        const isLocked = index > currentCookingStep;
        
        return `
          <div class="flex items-center gap-4 bg-white/20 backdrop-blur rounded-2xl p-4 ${isCompleted ? 'opacity-60' : ''} ${isCurrent ? 'ring-4 ring-white' : ''}">
            <div class="text-5xl ${isCurrent ? 'wiggle' : ''}">${step.emoji}</div>
            <div class="flex-1">
              <div class="font-bold text-lg mb-1">${step.verb}</div>
              <div class="text-sm opacity-90">${step.text}</div>
            </div>
            ${isCompleted ? `
              <div class="text-4xl">âœ…</div>
            ` : isCurrent ? `
              <button onclick="completeCookingStep()" class="bg-white text-purple-600 px-6 py-3 rounded-xl font-bold hover:bg-purple-50 transition pulse-glow">
                Do It! å®Œæˆ!
              </button>
            ` : `
              <div class="text-3xl opacity-40">ğŸ”’</div>
            `}
          </div>
        `;
      }).join('');
    }
    
    function completeCookingStep() {
      const step = currentCookingRecipe.steps[currentCookingStep];
      document.getElementById('cooking-status').textContent = `${step.verb} âœ“ Great job! åšå¾—å¥½!`;
      
      currentCookingStep++;
      
      if (currentCookingStep >= currentCookingRecipe.steps.length) {
        // Recipe complete!
        setTimeout(() => {
          document.getElementById('cooking-steps').classList.add('hidden');
          document.getElementById('cooking-complete').classList.remove('hidden');
          document.getElementById('completed-dish-name').textContent = currentCookingRecipe.name;
          
          // Remove used ingredients from fridge
          const usedIngredients = [...currentCookingRecipe.requiredIngredients, ...currentCookingRecipe.optionalIngredients];
          usedIngredients.forEach(ing => {
            const fridgeItem = fridge.find(f => f.en === ing);
            if (fridgeItem) {
              fridgeItem.qty--;
              if (fridgeItem.qty <= 0) {
                fridge = fridge.filter(f => f.id !== fridgeItem.id);
              }
            }
          });
          
          renderFridge();
        }, 1000);
      } else {
        renderCookingSteps();
      }
    }
    
    function exitCookingGame() {
      document.getElementById('cooking-game').classList.add('hidden');
      renderRecipeSuggestions();
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9bfe100c61fc20e9',t:'MTc2ODczODk5Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>